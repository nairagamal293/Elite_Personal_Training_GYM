<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Elite Gym</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- Google Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css">
    <!-- Select2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" rel="stylesheet" />
    <!-- Custom CSS -->
    <style>
        :root {
            --primary-color: #800020;   /* Burgundy */
            --secondary-color: #a05259; /* Muted rose/burgundy tint */
            --success-color: #6b8e23;   /* Olive green */
            --info-color: #b76e79;      /* Dusty rose accent */
            --warning-color: #d4a017;   /* Gold/mustard */
            --danger-color: #8b0000;    /* Dark red */
            --light-color: #f9f4f5;     /* Very light pinkish off-white */
            --dark-color: #3b0a0a;      /* Very dark burgundy */
            --sidebar-width: 250px;
            --header-height: 70px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fc;
            color: #5a5c69;
            font-size: 0.9rem;
            overflow-x: hidden;
        }

        /* Layout Structure */
        .wrapper {
            display: flex;
            width: 100%;
            min-height: 100vh;
        }

        /* Sidebar Styles */
        .sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(180deg, #800020 0%, #3b0a0a 100%);
            color: white;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            transition: all 0.3s ease;
            z-index: 1000;
            box-shadow: 0 0.15rem 1.75rem 0 rgba(128, 0, 32, 0.25);
        }

        .sidebar-brand {
            height: var(--header-height);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.1);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-brand .brand-logo {
            font-size: 1.8rem;
            font-weight: 700;
            color: white;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .sidebar-nav {
            padding: 1rem 0;
        }

        .sidebar-item {
            position: relative;
            margin: 0.2rem 0;
        }

        .sidebar-link {
            display: flex;
            align-items: center;
            padding: 0.8rem 1.5rem;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .sidebar-link:hover {
            color: white;
            background: rgba(255, 255, 255, 0.1);
            border-left-color: var(--warning-color);
        }

        .sidebar-link.active {
            color: white;
            background: rgba(255, 255, 255, 0.15);
            border-left-color: var(--warning-color);
        }

        .sidebar-link i {
            font-size: 1.2rem;
            margin-right: 0.8rem;
            width: 24px;
            text-align: center;
        }

        .sidebar-heading {
            padding: 0.5rem 1.5rem;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 1rem;
            margin-bottom: 0.5rem;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: white;
            height: var(--header-height);
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 1.5rem;
            position: sticky;
            top: 0;
            z-index: 999;
        }

        .header-left {
            display: flex;
            align-items: center;
        }

        .menu-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--primary-color);
            font-size: 1.5rem;
            margin-right: 1rem;
        }

        .header-title {
            font-weight: 600;
            color: var(--dark-color);
            font-size: 1.2rem;
        }

        .header-right {
            display: flex;
            align-items: center;
        }

        .user-dropdown {
            position: relative;
        }

        .user-info {
            display: flex;
            align-items: center;
            padding: 0.5rem 1rem;
            background: var(--light-color);
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .user-info:hover {
            background: #e2e6ea;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 0.5rem;
        }

        .user-name {
            font-weight: 500;
            color: var(--dark-color);
        }

        /* Main Content Area */
        .content {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
        }

        /* Dashboard Stats Cards */
        .stats-card {
            border: none;
            border-radius: 0.5rem;
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.1);
            transition: transform 0.3s ease;
            height: 100%;
            overflow: hidden;
        }

        .stats-card:hover {
            transform: translateY(-5px);
        }

        .stats-card .card-body {
            padding: 1.25rem;
            position: relative;
        }

        .stats-card .border-left-primary {
            border-left: 0.25rem solid var(--primary-color) !important;
        }

        .stats-card .border-left-success {
            border-left: 0.25rem solid var(--success-color) !important;
        }

        .stats-card .border-left-info {
            border-left: 0.25rem solid var(--info-color) !important;
        }

        .stats-card .border-left-warning {
            border-left: 0.25rem solid var(--warning-color) !important;
        }

        .stats-card .text-primary {
            color: var(--primary-color) !important;
        }

        .stats-card .text-success {
            color: var(--success-color) !important;
        }

        .stats-card .text-info {
            color: var(--info-color) !important;
        }

        .stats-card .text-warning {
            color: var(--warning-color) !important;
        }

        .stats-card .text-gray-800 {
            color: #5a5c69 !important;
        }

        .stats-card .text-gray-300 {
            color: #dddfeb !important;
        }

        .stats-card .fa-2x {
            font-size: 2rem;
        }

        .stats-card .text-xs {
            font-size: 0.7rem;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.05em;
        }

        .stats-card .stats-icon {
            position: absolute;
            right: 1rem;
            top: 1rem;
            opacity: 0.3;
            font-size: 2.5rem;
        }

        /* Tab Navigation */
        .nav-tabs {
            border-bottom: none;
            margin-bottom: 1.5rem;
            background: white;
            border-radius: 0.5rem;
            padding: 0.5rem;
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.1);
        }

        .nav-tabs .nav-link {
            color: var(--dark-color);
            font-weight: 500;
            padding: 0.75rem 1rem;
            border: none;
            border-radius: 0.5rem;
            margin-right: 0.25rem;
            background-color: transparent;
            transition: all 0.3s ease;
        }

        .nav-tabs .nav-link:hover {
            background-color: #f8f9fc;
            color: var(--primary-color);
        }

        .nav-tabs .nav-link.active {
            color: white;
            background-color: var(--primary-color);
            box-shadow: 0 0.15rem 1.75rem 0 rgba(128, 0, 32, 0.2);
        }

        /* Cards */
        .card {
            border: none;
            border-radius: 0.5rem;
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.1);
            margin-bottom: 1.5rem;
        }

        .card-header {
            background-color: white;
            border-bottom: 1px solid #e3e6f0;
            padding: 1rem 1.25rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        .card-header h6 {
            margin: 0;
            font-weight: 600;
            color: var(--dark-color);
        }

        .card-header .dropdown-toggle {
            color: var(--secondary-color);
        }

        .card-body {
            padding: 1.25rem;
        }

        /* Buttons */
        .btn {
            border-radius: 0.35rem;
            font-weight: 500;
            padding: 0.375rem 0.75rem;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .btn-primary:hover {
            background-color: #6a001a;
            border-color: #6a001a;
        }

        .btn-success {
            background-color: var(--success-color);
            border-color: var(--success-color);
        }

        .btn-success:hover {
            background-color: #5a7e1d;
            border-color: #5a7e1d;
        }

        .btn-info {
            background-color: var(--info-color);
            border-color: var(--info-color);
        }

        .btn-info:hover {
            background-color: #a55e69;
            border-color: #a55e69;
        }

        .btn-warning {
            background-color: var(--warning-color);
            border-color: var(--warning-color);
            color: white;
        }

        .btn-warning:hover {
            background-color: #c09015;
            border-color: #c09015;
            color: white;
        }

        .btn-danger {
            background-color: var(--danger-color);
            border-color: var(--danger-color);
        }

        .btn-danger:hover {
            background-color: #7b0000;
            border-color: #7b0000;
        }

        .btn-outline-primary {
            color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .btn-outline-primary:hover {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .btn-outline-secondary {
            color: var(--secondary-color);
            border-color: var(--secondary-color);
        }

        .btn-outline-secondary:hover {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
        }

        .btn-outline-danger {
            color: var(--danger-color);
            border-color: var(--danger-color);
        }

        .btn-outline-danger:hover {
            background-color: var(--danger-color);
            border-color: var(--danger-color);
        }

        .btn-outline-info {
            color: var(--info-color);
            border-color: var(--info-color);
        }

        .btn-outline-info:hover {
            background-color: var(--info-color);
            border-color: var(--info-color);
        }

        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
        }

        /* Tables */
        .table {
            color: var(--dark-color);
        }

        .table thead th {
            background-color: #f8f9fc;
            border-bottom: 2px solid #e3e6f0;
            font-weight: 600;
            color: var(--dark-color);
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 0.05em;
            padding: 0.75rem;
        }

        .table td, .table th {
            padding: 0.75rem;
            vertical-align: middle;
        }

        .table tbody tr {
            transition: all 0.2s ease;
        }

        .table tbody tr:hover {
            background-color: rgba(0, 0, 0, 0.02);
        }

        .table-bordered {
            border: 1px solid #e3e6f0;
        }

        .table-bordered th, .table-bordered td {
            border: 1px solid #e3e6f0;
        }

        /* Badges */
        .badge {
            padding: 0.35em 0.65em;
            font-weight: 500;
            font-size: 0.75rem;
        }

        /* Forms */
        .form-control, .form-select {
            border-radius: 0.35rem;
            border: 1px solid #d1d3e2;
            padding: 0.5rem 0.75rem;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        .form-control:focus, .form-select:focus {
            border-color: #c8a5b0;
            box-shadow: 0 0 0 0.2rem rgba(128, 0, 32, 0.25);
        }

        .form-label {
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 0.5rem;
        }

        /* Modals */
        .modal-content {
            border: none;
            border-radius: 0.5rem;
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
        }

        .modal-header {
            background-color: #f8f9fc;
            border-bottom: 1px solid #e3e6f0;
            padding: 1rem 1.25rem;
            border-radius: 0.5rem 0.5rem 0 0;
        }

        .modal-header h5 {
            font-weight: 600;
            color: var(--dark-color);
        }

        .modal-footer {
            background-color: #f8f9fc;
            border-top: 1px solid #e3e6f0;
            padding: 1rem 1.25rem;
            border-radius: 0 0 0.5rem 0.5rem;
        }

        /* Charts */
        .chart-area {
            position: relative;
            height: 320px;
            width: 100%;
        }

        /* Pagination */
        .page-link {
            color: var(--primary-color);
            border-radius: 0.35rem;
            margin: 0 2px;
            border: 1px solid #e3e6f0;
            padding: 0.5rem 0.75rem;
        }

        .page-item.active .page-link {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        /* List Group */
        .list-group-item {
            border: 1px solid #e3e6f0;
            padding: 0.75rem 1rem;
            margin-bottom: 0.25rem;
            border-radius: 0.35rem;
            transition: all 0.2s ease;
        }

        .list-group-item:hover {
            background-color: #f8f9fc;
        }

        /* Utility Classes */
        .text-gray-600 {
            color: #5a5c69 !important;
        }

        .text-gray-500 {
            color: #858796 !important;
        }

        .text-gray-400 {
            color: #b7b9cc !important;
        }

        .text-gray-300 {
            color: #dddfeb !important;
        }

        .text-gray-200 {
            color: #eaecf4 !important;
        }

        .text-gray-100 {
            color: #f8f9fc !important;
        }

        .bg-gray-100 {
            background-color: #f8f9fc !important;
        }

        .bg-gray-200 {
            background-color: #eaecf4 !important;
        }

        .bg-gray-300 {
            background-color: #dddfeb !important;
        }

        .bg-gray-400 {
            background-color: #b7b9cc !important;
        }

        .bg-gray-500 {
            background-color: #858796 !important;
        }

        .bg-gray-600 {
            background-color: #5a5c69 !important;
        }

        /* Responsive */
        @media (max-width: 992px) {
            .sidebar {
                margin-left: -250px;
            }
            
            .sidebar.active {
                margin-left: 0;
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .menu-toggle {
                display: block;
            }
        }

        @media (max-width: 768px) {
            .stats-card {
                margin-bottom: 1rem;
            }
            
            .chart-area {
                height: 250px;
            }
            
            .header-title {
                display: none;
            }
        }

        .spinner-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .modal-high-zindex {
            z-index: 1060 !important;
        }
        .modal-backdrop-high-zindex {
            z-index: 1050 !important;
        }
    </style>
</head>
<body>
    <div class="wrapper">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-brand">
                <a href="../index.html" class="brand-logo">
                    <i class="bi bi-lightning-charge-fill"></i> Elite Gym
                </a>
            </div>
            <div class="sidebar-nav">
                <div class="sidebar-item">
                    <a href="#" class="sidebar-link active" data-bs-toggle="tab" data-bs-target="#dashboard-pane">
                        <i class="bi bi-speedometer2"></i> Dashboard
                    </a>
                </div>
                <div class="sidebar-item">
                    <a href="#" class="sidebar-link" data-bs-toggle="tab" data-bs-target="#users-pane">
                        <i class="bi bi-people"></i> Users
                    </a>
                </div>
                <div class="sidebar-item">
                    <a href="#" class="sidebar-link" data-bs-toggle="tab" data-bs-target="#bookings-pane">
                        <i class="bi bi-calendar-check"></i> Bookings
                    </a>
                </div>
                <div class="sidebar-item">
                    <a href="#" class="sidebar-link" data-bs-toggle="tab" data-bs-target="#classes-pane">
                        <i class="bi bi-calendar-event"></i> Classes
                    </a>
                </div>
                <div class="sidebar-item">
                    <a href="#" class="sidebar-link" data-bs-toggle="tab" data-bs-target="#sessions-pane">
                        <i class="bi bi-laptop"></i> Online Sessions
                    </a>
                </div>
                <div class="sidebar-item">
                    <a href="#" class="sidebar-link" data-bs-toggle="tab" data-bs-target="#trainers-pane">
                        <i class="bi bi-person-badge"></i> Trainers
                    </a>
                </div>
                <div class="sidebar-item">
                    <a href="#" class="sidebar-link" data-bs-toggle="tab" data-bs-target="#memberships-pane">
                        <i class="bi bi-card-checklist"></i> Memberships
                    </a>
                </div>
                <div class="sidebar-item">
                    <a href="#" class="sidebar-link" data-bs-toggle="tab" data-bs-target="#products-pane">
                        <i class="bi bi-bag"></i> Products
                    </a>
                </div>
                <div class="sidebar-item">
                    <a href="#" class="sidebar-link" data-bs-toggle="tab" data-bs-target="#promotions-pane">
                        <i class="bi bi-tags"></i> Promotions
                    </a>
                </div>
                <div class="sidebar-item">
                    <a href="#" class="sidebar-link" data-bs-toggle="tab" data-bs-target="#orders-pane">
                        <i class="bi bi-cart-check"></i> Orders
                    </a>
                </div>
                <div class="sidebar-item">
                    <a href="#" class="sidebar-link" data-bs-toggle="tab" data-bs-target="#reports-pane">
                        <i class="bi bi-graph-up"></i> Reports
                    </a>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <button class="menu-toggle" id="menu-toggle">
                        <i class="bi bi-list"></i>
                    </button>
                    <h1 class="header-title" id="page-title">Admin Dashboard</h1>
                </div>
                <div class="header-right">
                    <div class="user-dropdown">
                        <div class="user-info" id="user-dropdown-toggle">
                            <div class="user-avatar">A</div>
                            <span class="user-name" id="user-name">Admin</span>
                            <i class="bi bi-chevron-down ms-2"></i>
                        </div>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="user-dropdown-toggle">
                            <li><a class="dropdown-item" href="#" id="logout-btn">Logout</a></li>
                        </ul>
                    </div>
                </div>
            </header>

            <!-- Main Content Area -->
            <main class="content">
                <!-- Dashboard Stats -->
                <div class="row mb-4">
                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="card stats-card border-left-primary shadow h-100 py-2">
                            <div class="card-body">
                                <div class="row no-gutters align-items-center">
                                    <div class="col mr-2">
                                        <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">Total Users</div>
                                        <div class="h5 mb-0 font-weight-bold text-gray-800" id="total-users">0</div>
                                    </div>
                                    <div class="col-auto">
                                        <i class="bi bi-people-fill stats-icon text-primary"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="card stats-card border-left-success shadow h-100 py-2">
                            <div class="card-body">
                                <div class="row no-gutters align-items-center">
                                    <div class="col mr-2">
                                        <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Active Memberships</div>
                                        <div class="h5 mb-0 font-weight-bold text-gray-800" id="active-memberships">0</div>
                                    </div>
                                    <div class="col-auto">
                                        <i class="bi bi-card-checklist stats-icon text-success"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="card stats-card border-left-info shadow h-100 py-2">
                            <div class="card-body">
                                <div class="row no-gutters align-items-center">
                                    <div class="col mr-2">
                                        <div class="text-xs font-weight-bold text-info text-uppercase mb-1">Bookings Today</div>
                                        <div class="h5 mb-0 font-weight-bold text-gray-800" id="bookings-today">0</div>
                                    </div>
                                    <div class="col-auto">
                                        <i class="bi bi-calendar-check stats-icon text-info"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="card stats-card border-left-warning shadow h-100 py-2">
                            <div class="card-body">
                                <div class="row no-gutters align-items-center">
                                    <div class="col mr-2">
                                        <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">Revenue This Month</div>
                                        <div class="h5 mb-0 font-weight-bold text-gray-800" id="revenue-month">$0.00</div>
                                    </div>
                                    <div class="col-auto">
                                        <i class="bi bi-currency-dollar stats-icon text-warning"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab Navigation -->
                <ul class="nav nav-tabs" id="adminTabs" role="tablist" style="display: none;">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" data-bs-target="#dashboard-pane" type="button" role="tab" aria-controls="dashboard-pane" aria-selected="true">Dashboard</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="users-tab" data-bs-toggle="tab" data-bs-target="#users-pane" type="button" role="tab" aria-controls="users-pane" aria-selected="false">Users</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="bookings-tab" data-bs-toggle="tab" data-bs-target="#bookings-pane" type="button" role="tab" aria-controls="bookings-pane" aria-selected="false">Bookings</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="classes-tab" data-bs-toggle="tab" data-bs-target="#classes-pane" type="button" role="tab" aria-controls="classes-pane" aria-selected="false">Classes</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="sessions-tab" data-bs-toggle="tab" data-bs-target="#sessions-pane" type="button" role="tab" aria-controls="sessions-pane" aria-selected="false">Online Sessions</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="trainers-tab" data-bs-toggle="tab" data-bs-target="#trainers-pane" type="button" role="tab" aria-controls="trainers-pane" aria-selected="false">Trainers</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="memberships-tab" data-bs-toggle="tab" data-bs-target="#memberships-pane" type="button" role="tab" aria-controls="memberships-pane" aria-selected="false">Memberships</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="products-tab" data-bs-toggle="tab" data-bs-target="#products-pane" type="button" role="tab" aria-controls="products-pane" aria-selected="false">Products</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="promotions-tab" data-bs-toggle="tab" data-bs-target="#promotions-pane" type="button" role="tab" aria-controls="promotions-pane" aria-selected="false">Promotions</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="orders-tab" data-bs-toggle="tab" data-bs-target="#orders-pane" type="button" role="tab" aria-controls="orders-pane" aria-selected="false">Orders</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="reports-tab" data-bs-toggle="tab" data-bs-target="#reports-pane" type="button" role="tab" aria-controls="reports-pane" aria-selected="false">Reports</button>
                    </li>
                </ul>

                <!-- Tab Content -->
                <div class="tab-content" id="adminTabContent">
                    <!-- Dashboard Tab -->
                    <div class="tab-pane fade show active" id="dashboard-pane" role="tabpanel" aria-labelledby="dashboard-tab">
                        <!-- Charts Row -->
                        <div class="row">
                            <!-- Revenue Chart -->
                            <div class="col-xl-8 col-lg-7">
                                <div class="card shadow mb-4">
                                    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                        <h6 class="m-0 font-weight-bold text-primary">Revenue Overview</h6>
                                        <div class="dropdown no-arrow">
                                            <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false">
                                                <i class="bi bi-three-dots-vertical"></i>
                                            </a>
                                            <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in" aria-labelledby="dropdownMenuLink">
                                                <div class="dropdown-header">Select Period:</div>
                                                <a class="dropdown-item" href="#" id="revenue-week">This Week</a>
                                                <a class="dropdown-item" href="#" id="revenue-month">This Month</a>
                                                <a class="dropdown-item" href="#" id="revenue-year">This Year</a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-area">
                                            <canvas id="revenueChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Recent Activity -->
                            <div class="col-xl-4 col-lg-5">
                                <div class="card shadow mb-4">
                                    <div class="card-header py-3">
                                        <h6 class="m-0 font-weight-bold text-primary">Recent Activity</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="list-group" id="recent-activity">
                                            <!-- Recent activity items will be loaded here -->
                                            <div class="text-center py-3">
                                                <div class="spinner-border text-primary" role="status">
                                                    <span class="visually-hidden">Loading...</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Low Stock Products Alert -->
                        <div class="row">
                            <div class="col-lg-12 mb-4">
                                <div class="card shadow">
                                    <div class="card-header py-3">
                                        <h6 class="m-0 font-weight-bold text-primary">Low Stock Products</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-bordered" id="low-stock-products" width="100%" cellspacing="0">
                                                <thead>
                                                    <tr>
                                                        <th>Product Name</th>
                                                        <th>Category</th>
                                                        <th>Current Stock</th>
                                                        <th>Price</th>
                                                        <th>Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- Low stock products will be loaded here -->
                                                    <tr>
                                                        <td colspan="5" class="text-center">Loading...</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Users Tab -->
                    <div class="tab-pane fade" id="users-pane" role="tabpanel" aria-labelledby="users-tab">
                        <div class="card shadow mb-4">
                            <div class="card-header py-3 d-flex justify-content-between align-items-center">
                                <h6 class="m-0 font-weight-bold text-primary">Users Management</h6>
                                <div class="d-flex">
                                    <div class="input-group me-2" style="width: 250px;">
                                        <input type="text" class="form-control" id="users-search" placeholder="Search users...">
                                        <button class="btn btn-primary" id="users-search-btn">
                                            <i class="bi bi-search"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-bordered" id="users-table" width="100%" cellspacing="0">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>Name</th>
                                                <th>Email</th>
                                                <th>Phone</th>
                                                <th>Membership</th>
                                                <th>Status</th>
                                                <th>Created</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Users will be loaded here -->
                                            <tr>
                                                <td colspan="8" class="text-center">Loading...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <!-- Pagination -->
                                <nav aria-label="Users pagination" class="mt-3">
                                    <ul class="pagination justify-content-center" id="users-pagination">
                                        <!-- Pagination will be loaded here -->
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                    <!-- Bookings Tab -->
                    <div class="tab-pane fade" id="bookings-pane" role="tabpanel" aria-labelledby="bookings-tab">
                        <div class="card shadow mb-4">
                            <div class="card-header py-3 d-flex justify-content-between align-items-center">
                                <h6 class="m-0 font-weight-bold text-primary">Bookings Management</h6>
                                <div class="d-flex">
                                    <div class="input-group me-2" style="width: 200px;">
                                        <input type="date" class="form-control" id="bookings-start-date">
                                        <input type="date" class="form-control" id="bookings-end-date">
                                        <button class="btn btn-primary" id="bookings-filter-btn">
                                            <i class="bi bi-funnel"></i>
                                        </button>
                                    </div>
                                    <select class="form-select me-2" id="bookings-status-filter" style="width: 150px;">
                                        <option value="">All Status</option>
                                        <option value="Confirmed">Confirmed</option>
                                        <option value="Cancelled">Cancelled</option>
                                        <option value="Completed">Completed</option>
                                    </select>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-bordered" id="bookings-table" width="100%" cellspacing="0">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>User</th>
                                                <th>Type</th>
                                                <th>Class/Session</th>
                                                <th>Trainer</th>
                                                <th>Date</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Bookings will be loaded here -->
                                            <tr>
                                                <td colspan="8" class="text-center">Loading...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Classes Tab -->
                    <div class="tab-pane fade" id="classes-pane" role="tabpanel" aria-labelledby="classes-tab">
                        <div class="card shadow mb-4">
                            <div class="card-header py-3 d-flex justify-content-between align-items-center">
                                <h6 class="m-0 font-weight-bold text-primary">Classes Management</h6>
                                <button class="btn btn-primary" id="create-class-btn">
                                    <i class="bi bi-plus-circle"></i> Create New Class
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-bordered" id="classes-table" width="100%" cellspacing="0">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>Name</th>
                                                <th>Description</th>
                                                <th>Trainer</th>
                                                <th>Duration</th>
                                                <th>Capacity</th>
                                                <th>Price</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Classes will be loaded here -->
                                            <tr>
                                                <td colspan="8" class="text-center">Loading...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Online Sessions Tab -->
                    <div class="tab-pane fade" id="sessions-pane" role="tabpanel" aria-labelledby="sessions-tab">
                        <div class="card shadow mb-4">
                            <div class="card-header py-3 d-flex justify-content-between align-items-center">
                                <h6 class="m-0 font-weight-bold text-primary">Online Sessions Management</h6>
                                <button class="btn btn-primary" id="create-session-btn">
                                    <i class="bi bi-plus-circle"></i> Create New Session
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-bordered" id="sessions-table" width="100%" cellspacing="0">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>Name</th>
                                                <th>Description</th>
                                                <th>Trainer</th>
                                                <th>Duration</th>
                                                <th>Price</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Sessions will be loaded here -->
                                            <tr>
                                                <td colspan="7" class="text-center">Loading...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Trainers Tab -->
                    <div class="tab-pane fade" id="trainers-pane" role="tabpanel" aria-labelledby="trainers-tab">
                        <div class="card shadow mb-4">
                            <div class="card-header py-3 d-flex justify-content-between align-items-center">
                                <h6 class="m-0 font-weight-bold text-primary">Trainers Management</h6>
                                <button class="btn btn-primary" id="create-trainer-btn">
                                    <i class="bi bi-plus-circle"></i> Create New Trainer
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-bordered" id="trainers-table" width="100%" cellspacing="0">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>Name</th>
                                                <th>Specialization</th>
                                                <th>Experience</th>
                                                <th>Certifications</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Trainers will be loaded here -->
                                            <tr>
                                                <td colspan="6" class="text-center">Loading...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Memberships Tab -->
                    <div class="tab-pane fade" id="memberships-pane" role="tabpanel" aria-labelledby="memberships-tab">
                        <div class="card shadow mb-4">
                            <div class="card-header py-3 d-flex justify-content-between align-items-center">
                                <h6 class="m-0 font-weight-bold text-primary">Membership Types Management</h6>
                                <button class="btn btn-primary" id="create-membership-btn">
                                    <i class="bi bi-plus-circle"></i> Create New Type
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-bordered" id="memberships-table" width="100%" cellspacing="0">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>Name</th>
                                                <th>Description</th>
                                                <th>Duration</th>
                                                <th>Hours</th>
                                                <th>Price</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Memberships will be loaded here -->
                                            <tr>
                                                <td colspan="8" class="text-center">Loading...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Products Tab -->
                    <div class="tab-pane fade" id="products-pane" role="tabpanel" aria-labelledby="products-tab">
                        <div class="card shadow mb-4">
                            <div class="card-header py-3 d-flex justify-content-between align-items-center">
                                <h6 class="m-0 font-weight-bold text-primary">Products Management</h6>
                                <button class="btn btn-primary" id="create-product-btn">
                                    <i class="bi bi-plus-circle"></i> Create New Product
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-bordered" id="products-table" width="100%" cellspacing="0">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>Name</th>
                                                <th>Description</th>
                                                <th>Category</th>
                                                <th>Price</th>
                                                <th>Stock</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Products will be loaded here -->
                                            <tr>
                                                <td colspan="7" class="text-center">Loading...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Promotions Tab -->
                    <div class="tab-pane fade" id="promotions-pane" role="tabpanel" aria-labelledby="promotions-tab">
                        <div class="card shadow mb-4">
                            <div class="card-header py-3 d-flex justify-content-between align-items-center">
                                <h6 class="m-0 font-weight-bold text-primary">Promotions Management</h6>
                                <button class="btn btn-primary" id="create-promotion-btn">
                                    <i class="bi bi-plus-circle"></i> Create New Promotion
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-bordered" id="promotions-table" width="100%" cellspacing="0">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>Code</th>
                                                <th>Description</th>
                                                <th>Discount</th>
                                                <th>Start Date</th>
                                                <th>End Date</th>
                                                <th>Usage</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Promotions will be loaded here -->
                                            <tr>
                                                <td colspan="8" class="text-center">Loading...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Orders Tab -->
                    <div class="tab-pane fade" id="orders-pane" role="tabpanel" aria-labelledby="orders-tab">
                        <div class="card shadow mb-4">
                            <div class="card-header py-3 d-flex justify-content-between align-items-center">
                                <h6 class="m-0 font-weight-bold text-primary">Orders Management</h6>
                                <select class="form-select" id="orders-status-filter" style="width: 150px;">
                                    <option value="">All Status</option>
                                    <option value="Pending">Pending</option>
                                    <option value="Completed">Completed</option>
                                    <option value="Cancelled">Cancelled</option>
                                </select>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-bordered" id="orders-table" width="100%" cellspacing="0">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>User</th>
                                                <th>Date</th>
                                                <th>Total</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Orders will be loaded here -->
                                            <tr>
                                                <td colspan="6" class="text-center">Loading...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Reports Tab -->
                    <div class="tab-pane fade" id="reports-pane" role="tabpanel" aria-labelledby="reports-tab">
                        <div class="card shadow mb-4">
                            <div class="card-header py-3">
                                <h6 class="m-0 font-weight-bold text-primary">Revenue Report</h6>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-5">
                                        <label for="report-start-date" class="form-label">Start Date</label>
                                        <input type="date" class="form-control" id="report-start-date">
                                    </div>
                                    <div class="col-md-5">
                                        <label for="report-end-date" class="form-label">End Date</label>
                                        <input type="date" class="form-control" id="report-end-date">
                                    </div>
                                    <div class="col-md-2 d-flex align-items-end">
                                        <button class="btn btn-primary w-100" id="generate-report-btn">Generate</button>
                                    </div>
                                </div>
                                <div class="chart-area">
                                    <canvas id="reportChart"></canvas>
                                </div>
                                <div class="table-responsive mt-4">
                                    <table class="table table-bordered" id="report-table" width="100%" cellspacing="0">
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>Membership Revenue</th>
                                                <th>Product Revenue</th>
                                                <th>Total Revenue</th>
                                                <th>Bookings Count</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Report data will be loaded here -->
                                            <tr>
                                                <td colspan="5" class="text-center">Generate a report to see data</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modals -->
    <!-- Create/Edit Class Modal -->
    <div class="modal fade" id="classModal" tabindex="-1" aria-labelledby="classModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="classModalLabel">Create New Class</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="class-form">
                        <input type="hidden" id="class-id">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="class-name" class="form-label">Name</label>
                                <input type="text" class="form-control" id="class-name" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="class-trainer" class="form-label">Trainer</label>
                                <select class="form-select" id="class-trainer" required>
                                    <option value="">Select Trainer</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="class-description" class="form-label">Description</label>
                            <textarea class="form-control" id="class-description" rows="3" required></textarea>
                        </div>
                        <div class="row">
                           <div class="col-md-4 mb-3">
    <label for="class-duration" class="form-label">Duration (minutes)</label>
    <input type="number" class="form-control" id="class-duration" min="15" step="15" required>
</div>
                            <div class="col-md-4 mb-3">
                                <label for="class-capacity" class="form-label">Max Capacity</label>
                                <input type="number" class="form-control" id="class-capacity" min="1" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="class-price" class="form-label">Price</label>
                                <input type="number" class="form-control" id="class-price" min="0" step="0.01" required>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-class-btn">Save Class</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Create/Edit Online Session Modal -->
    <div class="modal fade" id="sessionModal" tabindex="-1" aria-labelledby="sessionModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="sessionModalLabel">Create New Online Session</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="session-form">
                        <input type="hidden" id="session-id">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="session-name" class="form-label">Name</label>
                                <input type="text" class="form-control" id="session-name" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="session-trainer" class="form-label">Trainer</label>
                                <select class="form-select" id="session-trainer" required>
                                    <option value="">Select Trainer</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="session-description" class="form-label">Description</label>
                            <textarea class="form-control" id="session-description" rows="3" required></textarea>
                        </div>
                        <div class="row">
                           <div class="col-md-6 mb-3">
    <label for="session-duration" class="form-label">Duration (minutes)</label>
    <input type="number" class="form-control" id="session-duration" min="15" step="15" required>
</div>
                            <div class="col-md-6 mb-3">
                                <label for="session-price" class="form-label">Price</label>
                                <input type="number" class="form-control" id="session-price" min="0" step="0.01" required>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-session-btn">Save Session</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Create/Edit Trainer Modal -->
    <div class="modal fade" id="trainerModal" tabindex="-1" aria-labelledby="trainerModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="trainerModalLabel">Create New Trainer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="trainer-form">
                        <input type="hidden" id="trainer-id">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="trainer-name" class="form-label">Name</label>
                                <input type="text" class="form-control" id="trainer-name" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="trainer-specialization" class="form-label">Specialization</label>
                                <input type="text" class="form-control" id="trainer-specialization" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="trainer-experience" class="form-label">Experience (years)</label>
                                <input type="number" class="form-control" id="trainer-experience" min="0" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="trainer-certifications" class="form-label">Certifications</label>
                                <input type="text" class="form-control" id="trainer-certifications">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="trainer-bio" class="form-label">Bio</label>
                            <textarea class="form-control" id="trainer-bio" rows="3" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="trainer-image-file" class="form-label">Image</label>
                            <input type="file" class="form-control" id="trainer-image-file" accept="image/*">
                            <div id="trainer-image-preview" class="mt-2"></div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-trainer-btn">Save Trainer</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Create/Edit Membership Type Modal -->
    <div class="modal fade" id="membershipModal" tabindex="-1" aria-labelledby="membershipModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="membershipModalLabel">Create New Membership Type</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="membership-form">
                        <input type="hidden" id="membership-id">
                        <div class="mb-3">
                            <label for="membership-name" class="form-label">Name</label>
                            <input type="text" class="form-control" id="membership-name" required>
                        </div>
                        <div class="mb-3">
                            <label for="membership-description" class="form-label">Description</label>
                            <textarea class="form-control" id="membership-description" rows="2" required></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="membership-duration" class="form-label">Duration (months)</label>
                                <input type="number" class="form-control" id="membership-duration" min="1" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="membership-hours" class="form-label">Total Hours</label>
                                <input type="number" class="form-control" id="membership-hours" min="1" step="0.5" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="membership-price" class="form-label">Price</label>
                            <input type="number" class="form-control" id="membership-price" min="0" step="0.01" required>
                        </div>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="membership-active" checked>
                            <label class="form-check-label" for="membership-active">
                                Active
                            </label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-membership-btn">Save Membership Type</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Create/Edit Product Modal -->
    <div class="modal fade" id="productModal" tabindex="-1" aria-labelledby="productModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="productModalLabel">Create New Product</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="product-form">
                        <input type="hidden" id="product-id">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="product-name" class="form-label">Name</label>
                                <input type="text" class="form-control" id="product-name" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="product-category" class="form-label">Category</label>
                                <select class="form-select" id="product-category" required>
                                    <option value="">Select Category</option>
                                    <option value="Apparel">Apparel</option>
                                    <option value="Supplements">Supplements</option>
                                    <option value="Equipment">Equipment</option>
                                    <option value="Accessories">Accessories</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="product-description" class="form-label">Description</label>
                            <textarea class="form-control" id="product-description" rows="3" required></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="product-price" class="form-label">Price</label>
                                <input type="number" class="form-control" id="product-price" min="0" step="0.01" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="product-stock" class="form-label">Stock Quantity</label>
                                <input type="number" class="form-control" id="product-stock" min="0" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="product-image-file" class="form-label">Image</label>
                            <input type="file" class="form-control" id="product-image-file" accept="image/*">
                            <div id="product-image-preview" class="mt-2"></div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-product-btn">Save Product</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Create/Edit Promotion Modal -->
    <div class="modal fade" id="promotionModal" tabindex="-1" aria-labelledby="promotionModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="promotionModalLabel">Create New Promotion</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="promotion-form">
                        <input type="hidden" id="promotion-id">
                        <div class="mb-3">
                            <label for="promotion-code" class="form-label">Code</label>
                            <input type="text" class="form-control" id="promotion-code" required>
                        </div>
                        <div class="mb-3">
                            <label for="promotion-description" class="form-label">Description</label>
                            <textarea class="form-control" id="promotion-description" rows="2" required></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="promotion-type" class="form-label">Discount Type</label>
                                <select class="form-select" id="promotion-type" required>
                                    <option value="">Select Type</option>
                                    <option value="Percentage">Percentage</option>
                                    <option value="Fixed">Fixed Amount</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="promotion-value" class="form-label">Discount Value</label>
                                <input type="number" class="form-control" id="promotion-value" min="0" step="0.01" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="promotion-start" class="form-label">Start Date</label>
                                <input type="date" class="form-control" id="promotion-start" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="promotion-end" class="form-label">End Date</label>
                                <input type="date" class="form-control" id="promotion-end" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="promotion-limit" class="form-label">Usage Limit</label>
                            <input type="number" class="form-control" id="promotion-limit" min="1" value="100">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-promotion-btn">Save Promotion</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Create Class Schedule Modal -->
    <div class="modal fade" id="createClassScheduleModal" tabindex="-1" aria-labelledby="createClassScheduleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="createClassScheduleModalLabel">Create Class Schedule</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="create-class-schedule-form">
                        <input type="hidden" id="schedule-class-id">
                        <div class="mb-3">
                            <label for="schedule-start-time" class="form-label">Start Time</label>
                            <input type="datetime-local" class="form-control" id="schedule-start-time" required>
                        </div>
                        <div class="mb-3">
                            <label for="schedule-end-time" class="form-label">End Time</label>
                            <input type="datetime-local" class="form-control" id="schedule-end-time" required>
                        </div>
                        <div class="mb-3">
                            <label for="schedule-location" class="form-label">Location</label>
                            <input type="text" class="form-control" id="schedule-location" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-class-schedule-btn">Save Schedule</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Create Online Session Schedule Modal -->
    <div class="modal fade" id="createSessionScheduleModal" tabindex="-1" aria-labelledby="createSessionScheduleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="createSessionScheduleModalLabel">Create Session Schedule</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="create-session-schedule-form">
                        <input type="hidden" id="session-schedule-session-id">
                        <div class="mb-3">
                            <label for="session-schedule-start-time" class="form-label">Start Time</label>
                            <input type="datetime-local" class="form-control" id="session-schedule-start-time" required>
                        </div>
                        <div class="mb-3">
                            <label for="session-schedule-end-time" class="form-label">End Time</label>
                            <input type="datetime-local" class="form-control" id="session-schedule-end-time" required>
                        </div>
                        <div class="mb-3">
                            <label for="session-schedule-slots" class="form-label">Available Slots</label>
                            <input type="number" class="form-control" id="session-schedule-slots" min="1" max="20" value="20" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-session-schedule-btn">Save Schedule</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap 5 JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
    <!-- Select2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <!-- Custom JS -->
    <script src="../assets/js/main.js"></script>
    <script>
        // Helper function to get image URL
        function getImageUrl(imagePath) {
            if (!imagePath) return '';
            
            // Check if the imagePath is already a full URL
            if (imagePath.startsWith('http://') || imagePath.startsWith('https://')) {
                return imagePath;
            }
            
            // Use the API base URL for relative paths
            return `https://localhost:7182/${imagePath}`;
        }

       document.addEventListener('DOMContentLoaded', function() {
    // Check if user is admin
    if (!authService.isAdmin()) {
        window.location.href = '../login.html';
        return;
    }
    
    // Set user name in navbar
    const user = authService.getCurrentUser();
    if (user) {
        const userNameElement = document.getElementById('user-name');
        const userAvatarElement = document.querySelector('.user-avatar');
        if (userNameElement) {
            userNameElement.textContent = user.name;
        }
        if (userAvatarElement) {
            userAvatarElement.textContent = user.name.charAt(0).toUpperCase();
        }
    }
    
    // Initialize dropdown for user menu
    const userDropdownToggle = document.getElementById('user-dropdown-toggle');
    if (userDropdownToggle) {
        userDropdownToggle.addEventListener('click', function() {
            const dropdownMenu = this.nextElementSibling;
            if (dropdownMenu.classList.contains('show')) {
                dropdownMenu.classList.remove('show');
            } else {
                dropdownMenu.classList.add('show');
            }
        });
    }
    
    // Close dropdown when clicking outside
    document.addEventListener('click', function(event) {
        if (!event.target.closest('.user-dropdown')) {
            const dropdownMenu = document.querySelector('.user-dropdown .dropdown-menu');
            if (dropdownMenu && dropdownMenu.classList.contains('show')) {
                dropdownMenu.classList.remove('show');
            }
        }
    });
    
    // Logout functionality
    const logoutBtn = document.getElementById('logout-btn');
    if (logoutBtn) {
        logoutBtn.addEventListener('click', function(e) {
            e.preventDefault();
            authService.logout();
        });
    }
    
    // Sidebar toggle functionality
    const menuToggle = document.getElementById('menu-toggle');
    const sidebar = document.getElementById('sidebar');
    
    if (menuToggle && sidebar) {
        menuToggle.addEventListener('click', function() {
            sidebar.classList.toggle('active');
        });
    }
    
    // FIXED: Sidebar navigation functionality
    const sidebarLinks = document.querySelectorAll('.sidebar-link');
    const pageTitle = document.getElementById('page-title');
    const adminTabs = document.querySelector('#adminTabs');
    const tabPanes = document.querySelectorAll('.tab-pane');
    
    sidebarLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Remove active class from all links
            sidebarLinks.forEach(l => l.classList.remove('active'));
            
            // Add active class to clicked link
            this.classList.add('active');
            
            // Update page title
            if (pageTitle) {
                pageTitle.textContent = this.textContent.trim();
            }
            
            // Get the tab target
            const tabTarget = this.getAttribute('data-bs-target');
            if (tabTarget) {
                // Try to use Bootstrap's tab API first
                try {
                    const tabButton = adminTabs.querySelector(`button[data-bs-target="${tabTarget}"]`);
                    if (tabButton) {
                        const tabTrigger = new bootstrap.Tab(tabButton);
                        tabTrigger.show();
                    } else {
                        throw new Error('Tab button not found');
                    }
                } catch (error) {
                    console.warn('Bootstrap tab API failed, using fallback:', error);
                    
                    // Fallback: manually handle tab switching
                    tabPanes.forEach(pane => {
                        pane.classList.remove('show', 'active');
                    });
                    
                    // Also update tab buttons if they exist
                    if (adminTabs) {
                        const tabButtons = adminTabs.querySelectorAll('button');
                        tabButtons.forEach(btn => {
                            btn.classList.remove('active');
                        });
                        
                        const targetTabButton = adminTabs.querySelector(`button[data-bs-target="${tabTarget}"]`);
                        if (targetTabButton) {
                            targetTabButton.classList.add('active');
                        }
                    }
                    
                    // Show the target tab pane
                    const targetPane = document.querySelector(tabTarget);
                    if (targetPane) {
                        targetPane.classList.add('show', 'active');
                    } else {
                        console.error('Tab pane not found for target:', tabTarget);
                    }
                }
                
                // Load data for the active tab
                const tabId = tabTarget.substring(1);
                loadTabData(tabId);
            }
            
            // Close sidebar on mobile after selection
            if (window.innerWidth <= 992 && sidebar) {
                sidebar.classList.remove('active');
            }
        });
    });
    
    // Trainer image preview
    const trainerImageInput = document.getElementById('trainer-image-file');
    if (trainerImageInput) {
        trainerImageInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const preview = document.getElementById('trainer-image-preview');
                    preview.innerHTML = `<img src="${event.target.result}" class="img-thumbnail" style="max-width: 200px;">`;
                };
                reader.readAsDataURL(file);
            } else {
                document.getElementById('trainer-image-preview').innerHTML = '';
            }
        });
    }

    // Add event listeners for schedule save buttons
    const saveClassScheduleBtn = document.getElementById('save-class-schedule-btn');
    if (saveClassScheduleBtn) {
        saveClassScheduleBtn.addEventListener('click', saveClassSchedule);
    }
    
    const saveSessionScheduleBtn = document.getElementById('save-session-schedule-btn');
    if (saveSessionScheduleBtn) {
        saveSessionScheduleBtn.addEventListener('click', saveSessionSchedule);
    }

    // Product image preview
    const productImageInput = document.getElementById('product-image-file');
    if (productImageInput) {
        productImageInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const preview = document.getElementById('product-image-preview');
                    preview.innerHTML = `<img src="${event.target.result}" class="img-thumbnail" style="max-width: 200px;">`;
                };
                reader.readAsDataURL(file);
            } else {
                document.getElementById('product-image-preview').innerHTML = '';
            }
        });
    }
    
    // ADD THE MODAL CLOSE EVENT LISTENER HERE
    // Also update the modal close event to remove the classes when closed
    document.addEventListener('hidden.bs.modal', function (event) {
        // Remove the high z-index classes when any modal is closed
        const modalElement = event.target;
        if (modalElement.classList.contains('modal-high-zindex')) {
            modalElement.classList.remove('modal-high-zindex');
        }
        
        // Remove high z-index from backdrops
        const backdrops = document.querySelectorAll('.modal-backdrop-high-zindex');
        backdrops.forEach(backdrop => {
            backdrop.classList.remove('modal-backdrop-high-zindex');
        });
    });
    
    // Initialize tabs (for the hidden tab navigation)
    const triggerTabList = [].slice.call(document.querySelectorAll('#adminTabs button'));
    triggerTabList.forEach(function(triggerEl) {
        const tabTrigger = new bootstrap.Tab(triggerEl);
        triggerEl.addEventListener('click', function(event) {
            event.preventDefault();
            tabTrigger.show();
            
            // Load data for the active tab
            const tabId = triggerEl.getAttribute('data-bs-target').substring(1);
            loadTabData(tabId);
        });
    });
    
    // Load dashboard stats
    loadDashboardStats();
    // Load revenue chart
    loadRevenueChart('month');
    // Load recent activity
    loadRecentActivity();
    // Load low stock products
    loadLowStockProducts();
    
    // Refresh button
    const refreshBtn = document.getElementById('refresh-btn');
    if (refreshBtn) {
        refreshBtn.addEventListener('click', function() {
            const activeTab = document.querySelector('#adminTabs .nav-link.active');
            if (activeTab) {
                const tabId = activeTab.getAttribute('data-bs-target').substring(1);
                if (tabId === 'dashboard-pane') {
                    loadDashboardStats();
                    loadRevenueChart(currentRevenuePeriod);
                    loadRecentActivity();
                    loadLowStockProducts();
                } else {
                    loadTabData(tabId);
                }
            }
        });
    }
    
    // Revenue period buttons
    let currentRevenuePeriod = 'month';
    const revenueWeekBtn = document.getElementById('revenue-week');
    const revenueMonthBtn = document.getElementById('revenue-month');
    const revenueYearBtn = document.getElementById('revenue-year');
    
    if (revenueWeekBtn) {
        revenueWeekBtn.addEventListener('click', function(e) {
            e.preventDefault();
            currentRevenuePeriod = 'week';
            loadRevenueChart('week');
        });
    }
    
    if (revenueMonthBtn) {
        revenueMonthBtn.addEventListener('click', function(e) {
            e.preventDefault();
            currentRevenuePeriod = 'month';
            loadRevenueChart('month');
        });
    }
    
    if (revenueYearBtn) {
        revenueYearBtn.addEventListener('click', function(e) {
            e.preventDefault();
            currentRevenuePeriod = 'year';
            loadRevenueChart('year');
        });
    }
    
    // Users tab functionality
    const usersSearchBtn = document.getElementById('users-search-btn');
    if (usersSearchBtn) {
        usersSearchBtn.addEventListener('click', function() {
            loadUsers(1);
        });
    }
    
    // Bookings tab functionality
    const bookingsFilterBtn = document.getElementById('bookings-filter-btn');
    const bookingsStatusFilter = document.getElementById('bookings-status-filter');
    
    if (bookingsFilterBtn) {
        bookingsFilterBtn.addEventListener('click', function() {
            loadBookings();
        });
    }
    
    if (bookingsStatusFilter) {
        bookingsStatusFilter.addEventListener('change', function() {
            loadBookings();
        });
    }
    
    // Classes tab functionality
    const createClassBtn = document.getElementById('create-class-btn');
    if (createClassBtn) {
        createClassBtn.addEventListener('click', function() {
            openClassModal();
        });
    }
    
    // Sessions tab functionality
    const createSessionBtn = document.getElementById('create-session-btn');
    if (createSessionBtn) {
        createSessionBtn.addEventListener('click', function() {
            openSessionModal();
        });
    }
    
    // Trainers tab functionality
    const createTrainerBtn = document.getElementById('create-trainer-btn');
    if (createTrainerBtn) {
        createTrainerBtn.addEventListener('click', function() {
            openTrainerModal();
        });
    }
    
    // Memberships tab functionality
    const createMembershipBtn = document.getElementById('create-membership-btn');
    if (createMembershipBtn) {
        createMembershipBtn.addEventListener('click', function() {
            openMembershipModal();
        });
    }
    
    // Products tab functionality
    const createProductBtn = document.getElementById('create-product-btn');
    if (createProductBtn) {
        createProductBtn.addEventListener('click', function() {
            openProductModal();
        });
    }
    
    // Promotions tab functionality
    const createPromotionBtn = document.getElementById('create-promotion-btn');
    if (createPromotionBtn) {
        createPromotionBtn.addEventListener('click', function() {
            openPromotionModal();
        });
    }
    
    // Orders tab functionality
    const ordersStatusFilter = document.getElementById('orders-status-filter');
    if (ordersStatusFilter) {
        ordersStatusFilter.addEventListener('change', function() {
            loadOrders();
        });
    }
    
    // Reports tab functionality
    const generateReportBtn = document.getElementById('generate-report-btn');
    if (generateReportBtn) {
        generateReportBtn.addEventListener('click', function() {
            generateRevenueReport();
        });
    }
    
    // Modal save buttons
    const saveClassBtn = document.getElementById('save-class-btn');
    const saveSessionBtn = document.getElementById('save-session-btn');
    const saveTrainerBtn = document.getElementById('save-trainer-btn');
    const saveMembershipBtn = document.getElementById('save-membership-btn');
    const saveProductBtn = document.getElementById('save-product-btn');
    const savePromotionBtn = document.getElementById('save-promotion-btn');
    
    if (saveClassBtn) saveClassBtn.addEventListener('click', saveClass);
    if (saveSessionBtn) saveSessionBtn.addEventListener('click', saveSession);
    if (saveTrainerBtn) saveTrainerBtn.addEventListener('click', saveTrainer);
    if (saveMembershipBtn) saveMembershipBtn.addEventListener('click', saveMembership);
    if (saveProductBtn) saveProductBtn.addEventListener('click', saveProduct);
    if (savePromotionBtn) savePromotionBtn.addEventListener('click', savePromotion);
    
    // Initialize form validation
    initializeFormValidation();
});
       
       
        // Load data for the active tab
        function loadTabData(tabId) {
            switch(tabId) {
                case 'users-pane':
                    loadUsers(1);
                    break;
                case 'bookings-pane':
                    loadBookings();
                    break;
                case 'classes-pane':
                    loadClasses();
                    break;
                case 'sessions-pane':
                    loadSessions();
                    break;
                case 'trainers-pane':
                    loadTrainers();
                    break;
                case 'memberships-pane':
                    loadMemberships();
                    break;
                case 'products-pane':
                    loadProducts();
                    break;
                case 'promotions-pane':
                    loadPromotions();
                    break;
                case 'orders-pane':
                    loadOrders();
                    break;
                case 'reports-pane':
                    // Initialize report date range
                    const today = new Date();
                    const lastMonth = new Date();
                    lastMonth.setMonth(today.getMonth() - 1);
                    
                    const reportStartDate = document.getElementById('report-start-date');
                    const reportEndDate = document.getElementById('report-end-date');
                    
                    if (reportStartDate) reportStartDate.value = utils.formatDateForInput(lastMonth);
                    if (reportEndDate) reportEndDate.value = utils.formatDateForInput(today);
                    break;
            }
        }
        
        // Load dashboard statistics
        async function loadDashboardStats() {
            try {
                const stats = await apiService.getDashboardStats();
                
                const totalUsersElement = document.getElementById('total-users');
                const activeMembershipsElement = document.getElementById('active-memberships');
                const bookingsTodayElement = document.getElementById('bookings-today');
                const revenueMonthElement = document.getElementById('revenue-month');
                
                if (totalUsersElement) totalUsersElement.textContent = stats.totalUsers;
                if (activeMembershipsElement) activeMembershipsElement.textContent = stats.activeMemberships;
                if (bookingsTodayElement) bookingsTodayElement.textContent = stats.totalBookingsToday;
                if (revenueMonthElement) revenueMonthElement.textContent = uiHelper.formatCurrency(stats.revenueThisMonth);
            } catch (error) {
                console.error('Error loading dashboard stats:', error);
                uiHelper.showAlert('Error loading dashboard statistics', 'danger');
            }
        }
        
        // Load revenue chart
        let revenueChart = null;
        async function loadRevenueChart(period) {
            try {
                // Calculate date range based on period
                const endDate = new Date();
                let startDate = new Date();
                
                if (period === 'week') {
                    startDate.setDate(endDate.getDate() - 7);
                } else if (period === 'month') {
                    startDate.setMonth(endDate.getMonth() - 1);
                } else if (period === 'year') {
                    startDate.setFullYear(endDate.getFullYear() - 1);
                }
                
                // Format dates for API
                const startDateStr = startDate.toISOString().split('T')[0];
                const endDateStr = endDate.toISOString().split('T')[0];
                
                // Get revenue data
                const revenueData = await apiService.getRevenueReport(startDateStr, endDateStr);
                
                // Prepare data for chart
                const labels = revenueData.map(item => utils.formatDateForInput(item.date));
                const membershipRevenue = revenueData.map(item => item.membershipRevenue);
                const productRevenue = revenueData.map(item => item.productRevenue);
                
                // Get chart context
                const ctx = document.getElementById('revenueChart');
                if (!ctx) return;
                
                const chartCtx = ctx.getContext('2d');
                
                // Destroy existing chart if it exists
                if (revenueChart) {
                    revenueChart.destroy();
                }
                
                // Create new chart
                revenueChart = new Chart(chartCtx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Membership Revenue',
                                data: membershipRevenue,
                                lineTension: 0.3,
                                backgroundColor: 'rgba(128, 0, 32, 0.05)',
                                borderColor: 'rgba(128, 0, 32, 1)',
                                pointRadius: 3,
                                pointBackgroundColor: 'rgba(128, 0, 32, 1)',
                                pointBorderColor: '#fff',
                                pointHoverRadius: 5,
                                pointHoverBackgroundColor: 'rgba(128, 0, 32, 1)',
                                pointHoverBorderColor: 'rgba(128, 0, 32, 1)',
                                pointHitRadius: 10,
                                pointBorderWidth: 2,
                                fill: true
                            },
                            {
                                label: 'Product Revenue',
                                data: productRevenue,
                                lineTension: 0.3,
                                backgroundColor: 'rgba(107, 142, 35, 0.05)',
                                borderColor: 'rgba(107, 142, 35, 1)',
                                pointRadius: 3,
                                pointBackgroundColor: 'rgba(107, 142, 35, 1)',
                                pointBorderColor: '#fff',
                                pointHoverRadius: 5,
                                pointHoverBackgroundColor: 'rgba(107, 142, 35, 1)',
                                pointHoverBorderColor: 'rgba(107, 142, 35, 1)',
                                pointHitRadius: 10,
                                pointBorderWidth: 2,
                                fill: true
                            }
                        ]
                    },
                    options: {
                        maintainAspectRatio: false,
                        layout: {
                            padding: {
                                left: 10,
                                right: 25,
                                top: 25,
                                bottom: 0
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    display: false,
                                    drawBorder: false
                                },
                                ticks: {
                                    maxTicksLimit: 7
                                }
                            },
                            y: {
                                ticks: {
                                    maxTicksLimit: 5,
                                    padding: 10,
                                    callback: function(value) {
                                        return '$' + value.toLocaleString();
                                    }
                                },
                                grid: {
                                    color: 'rgb(234, 236, 244)',
                                    zeroLineColor: 'rgb(234, 236, 244)',
                                    drawBorder: false,
                                    borderDash: [2],
                                    zeroLineBorderDash: [2]
                                }
                            }
                        },
                        legend: {
                            display: true,
                            position: 'bottom'
                        },
                        tooltips: {
                            backgroundColor: 'rgb(255, 255, 255)',
                            bodyFontColor: '#858796',
                            titleMarginBottom: 10,
                            titleFontColor: '#6e707e',
                            titleFontSize: 14,
                            borderColor: '#dddfeb',
                            borderWidth: 1,
                            xPadding: 15,
                            yPadding: 15,
                            displayColors: false,
                            intersect: false,
                            mode: 'index',
                            caretPadding: 10,
                            callbacks: {
                                label: function(tooltipItem, chart) {
                                    var label = chart.datasets[tooltipItem.datasetIndex].label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    label += '$' + tooltipItem.yLabel.toLocaleString();
                                    return label;
                                }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Error loading revenue chart:', error);
                uiHelper.showAlert('Error loading revenue chart', 'danger');
            }
        }
        
        // Load recent activity
        async function loadRecentActivity() {
            try {
                // Get recent bookings
                const endDate = new Date();
                const startDate = new Date();
                startDate.setDate(endDate.getDate() - 7);
                
                const startDateStr = startDate.toISOString().split('T')[0];
                const endDateStr = endDate.toISOString().split('T')[0];
                
                const bookings = await apiService.getAllBookings(startDateStr, endDateStr);
                
                // Get recent orders
                const orders = await apiService.getAllOrders();
                
                // Combine and sort by date
                const activities = [];
                
                // Add bookings
                bookings.forEach(booking => {
                    activities.push({
                        type: 'booking',
                        date: new Date(booking.bookingDate),
                        description: `${booking.type === 'Class' ? 'Class' : 'Online Session'} booking by ${booking.trainerName}`,
                        status: booking.status,
                        icon: booking.type === 'Class' ? 'bi-calendar-event' : 'bi-laptop',
                        color: booking.status === 'Confirmed' ? 'success' : 'danger'
                    });
                });
                
                // Add orders
                orders.slice(0, 10).forEach(order => {
                    activities.push({
                        type: 'order',
                        date: new Date(order.orderDate),
                        description: `Order #${order.id} by ${order.userName}`,
                        status: order.status,
                        icon: 'bi-cart-check',
                        color: order.status === 'Completed' ? 'success' : 'warning'
                    });
                });
                
                // Sort by date (newest first)
                activities.sort((a, b) => b.date - a.date);
                
                // Take the top 10
                const recentActivities = activities.slice(0, 10);
                
                // Display activities
                const activityContainer = document.getElementById('recent-activity');
                if (!activityContainer) return;
                
                activityContainer.innerHTML = '';
                
                if (recentActivities.length === 0) {
                    activityContainer.innerHTML = '<div class="text-center py-3">No recent activity</div>';
                    return;
                }
                
                recentActivities.forEach(activity => {
                    const activityItem = document.createElement('a');
                    activityItem.href = '#';
                    activityItem.className = 'list-group-item list-group-item-action';
                    
                    activityItem.innerHTML = `
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">
                                <i class="bi ${activity.icon} text-${activity.color}"></i>
                                ${activity.description}
                            </h6>
                            <small>${uiHelper.formatDate(activity.date)}</small>
                        </div>
                        <p class="mb-1">Status: <span class="badge bg-${activity.color}">${activity.status}</span></p>
                    `;
                    
                    activityContainer.appendChild(activityItem);
                });
            } catch (error) {
                console.error('Error loading recent activity:', error);
                const activityContainer = document.getElementById('recent-activity');
                if (activityContainer) {
                    activityContainer.innerHTML = '<div class="text-center py-3 text-danger">Error loading recent activity</div>';
                }
            }
        }
        
        // Load low stock products
        async function loadLowStockProducts() {
            try {
                const products = await apiService.getProducts();
                const lowStockProducts = products.filter(product => product.stockQuantity <= 5);
                
                const tableBody = document.querySelector('#low-stock-products tbody');
                if (!tableBody) return;
                
                tableBody.innerHTML = '';
                
                if (lowStockProducts.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="5" class="text-center">No low stock products</td></tr>';
                    return;
                }
                
                lowStockProducts.forEach(product => {
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${product.name}</td>
                        <td>${product.category}</td>
                        <td><span class="badge bg-danger">${product.stockQuantity}</span></td>
                        <td>${uiHelper.formatCurrency(product.price)}</td>
                        <td>
                            <button class="btn btn-sm btn-primary update-stock-btn" data-id="${product.id}">
                                <i class="bi bi-pencil"></i> Update Stock
                            </button>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                });
                
                // Add event listeners to update stock buttons
                document.querySelectorAll('.update-stock-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const productId = this.getAttribute('data-id');
                        const newStock = prompt('Enter new stock quantity:');
                        if (newStock !== null && !isNaN(newStock) && newStock >= 0) {
                            updateProductStock(productId, parseInt(newStock));
                        }
                    });
                });
            } catch (error) {
                console.error('Error loading low stock products:', error);
                const tableBody = document.querySelector('#low-stock-products tbody');
                if (tableBody) {
                    tableBody.innerHTML = '<tr><td colspan="5" class="text-center text-danger">Error loading products</td></tr>';
                }
            }
        }
        
        // Update product stock
        async function updateProductStock(productId, quantity) {
            try {
                await apiService.updateProductStock(productId, quantity);
                uiHelper.showAlert('Product stock updated successfully', 'success');
                loadLowStockProducts();
                loadProducts(); // Refresh products tab if active
            } catch (error) {
                console.error('Error updating product stock:', error);
                uiHelper.showAlert('Error updating product stock: ' + error.message, 'danger');
            }
        }
        
        // Load users with pagination
        let usersCurrentPage = 1;
        const usersPageSize = 10;
        
        async function loadUsers(page = 1) {
            try {
                usersCurrentPage = page;
                const usersSearch = document.getElementById('users-search');
                const searchTerm = usersSearch ? usersSearch.value : '';
                
                let users;
                if (searchTerm) {
                    // If search term is provided, get all users and filter on client side
                    const allUsers = await apiService.getAllUsers(1, 1000); // Get a large number
                    users = allUsers.filter(user => 
                        user.name.toLowerCase().includes(searchTerm.toLowerCase()) || 
                        user.email.toLowerCase().includes(searchTerm.toLowerCase())
                    );
                } else {
                    users = await apiService.getAllUsers(page, usersPageSize);
                }
                
                const tableBody = document.querySelector('#users-table tbody');
                if (!tableBody) return;
                
                tableBody.innerHTML = '';
                
                if (users.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="8" class="text-center">No users found</td></tr>';
                    return;
                }
                
                users.forEach(user => {
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${user.id}</td>
                        <td>${user.name}</td>
                        <td>${user.email}</td>
                        <td>${user.phone || 'N/A'}</td>
                        <td>${user.membership ? user.membership.type : 'None'}</td>
                        <td>
                            <span class="badge ${user.membership && user.membership.status === 'Active' ? 'bg-success' : 'bg-secondary'}">
                                ${user.membership ? user.membership.status : 'Inactive'}
                            </span>
                        </td>
                        <td>${uiHelper.formatDate(user.createdAt)}</td>
                        <td>
                            <div class="btn-group">
                                <button class="btn btn-sm btn-outline-primary view-user-btn" data-id="${user.id}">
                                    <i class="bi bi-eye"></i>
                                </button>
                                
                            </div>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                });
                
                // Add event listeners
                document.querySelectorAll('.view-user-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const userId = this.getAttribute('data-id');
                        viewUserDetails(userId);
                    });
                });
                
                document.querySelectorAll('.delete-user-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const userId = this.getAttribute('data-id');
                        deleteUser(userId);
                    });
                });
                
                // Render pagination
                renderUsersPagination(users.length);
            } catch (error) {
                console.error('Error loading users:', error);
                const tableBody = document.querySelector('#users-table tbody');
                if (tableBody) {
                    tableBody.innerHTML = '<tr><td colspan="8" class="text-center text-danger">Error loading users</td></tr>';
                }
            }
        }
        
        // Render users pagination
        function renderUsersPagination(totalItems) {
            const pagination = document.getElementById('users-pagination');
            if (!pagination) return;
            
            pagination.innerHTML = '';
            
            const totalPages = Math.ceil(totalItems / usersPageSize);
            
            if (totalPages <= 1) return;
            
            // Previous button
            const prevLi = document.createElement('li');
            prevLi.className = `page-item ${usersCurrentPage === 1 ? 'disabled' : ''}`;
            prevLi.innerHTML = `<a class="page-link" href="#" data-page="${usersCurrentPage - 1}">Previous</a>`;
            pagination.appendChild(prevLi);
            
            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                const li = document.createElement('li');
                li.className = `page-item ${i === usersCurrentPage ? 'active' : ''}`;
                li.innerHTML = `<a class="page-link" href="#" data-page="${i}">${i}</a>`;
                pagination.appendChild(li);
            }
            
            // Next button
            const nextLi = document.createElement('li');
            nextLi.className = `page-item ${usersCurrentPage === totalPages ? 'disabled' : ''}`;
            nextLi.innerHTML = `<a class="page-link" href="#" data-page="${usersCurrentPage + 1}">Next</a>`;
            pagination.appendChild(nextLi);
            
            // Add event listeners
            pagination.querySelectorAll('.page-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = parseInt(this.getAttribute('data-page'));
                    if (page > 0 && page <= totalPages) {
                        loadUsers(page);
                    }
                });
            });
        }
        
        // View user details
        async function viewUserDetails(userId) {
            try {
                const user = await apiService.getUserDetails(userId);
                
                // Create a modal to show user details
                const modalHtml = `
                    <div class="modal fade" id="userDetailsModal" tabindex="-1" aria-labelledby="userDetailsModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="userDetailsModalLabel">User Details</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <div class="mb-3">
                                        <strong>ID:</strong> ${user.id}
                                    </div>
                                    <div class="mb-3">
                                        <strong>Name:</strong> ${user.name}
                                    </div>
                                    <div class="mb-3">
                                        <strong>Email:</strong> ${user.email}
                                    </div>
                                    <div class="mb-3">
                                        <strong>Phone:</strong> ${user.phone || 'N/A'}
                                    </div>
                                    <div class="mb-3">
                                        <strong>Member Since:</strong> ${uiHelper.formatDate(user.createdAt)}
                                    </div>
                                    ${user.membership ? `
                                        <div class="mb-3">
                                            <strong>Membership Type:</strong> ${user.membership.type}
                                        </div>
                                        <div class="mb-3">
                                            <strong>Membership Status:</strong> 
                                            <span class="badge ${user.membership.status === 'Active' ? 'bg-success' : 'bg-secondary'}">
                                                ${user.membership.status}
                                            </span>
                                        </div>
                                        <div class="mb-3">
                                            <strong>Start Date:</strong> ${uiHelper.formatDate(user.membership.startDate)}
                                        </div>
                                        <div class="mb-3">
                                            <strong>End Date:</strong> ${uiHelper.formatDate(user.membership.endDate)}
                                        </div>
                                        <div class="mb-3">
                                            <strong>Total Hours:</strong> ${user.membership.totalHours}
                                        </div>
                                        <div class="mb-3">
                                            <strong>Remaining Hours:</strong> ${user.membership.remainingHours}
                                        </div>
                                    ` : '<div class="mb-3"><strong>Membership:</strong> None</div>'}
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Add modal to DOM
                const modalContainer = document.createElement('div');
                modalContainer.innerHTML = modalHtml;
                document.body.appendChild(modalContainer);
                
                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('userDetailsModal'));
                modal.show();
                
                // Remove modal from DOM when hidden
                document.getElementById('userDetailsModal').addEventListener('hidden.bs.modal', function() {
                    document.body.removeChild(modalContainer);
                });
            } catch (error) {
                console.error('Error loading user details:', error);
                uiHelper.showAlert('Error loading user details', 'danger');
            }
        }
        
        // Delete user
        function deleteUser(userId) {
            uiHelper.confirm('Are you sure you want to delete this user? This action cannot be undone.', async function() {
                try {
                    // Note: This would require an API endpoint to delete users
                    // For now, we'll just show a success message
                    uiHelper.showAlert('User deleted successfully', 'success');
                    loadUsers(usersCurrentPage);
                } catch (error) {
                    console.error('Error deleting user:', error);
                    uiHelper.showAlert('Error deleting user', 'danger');
                }
            });
        }
        
        async function loadBookings() {
            try {
                const bookingsStartDate = document.getElementById('bookings-start-date');
                const bookingsEndDate = document.getElementById('bookings-end-date');
                const bookingsStatusFilter = document.getElementById('bookings-status-filter');
                
                const startDate = bookingsStartDate ? bookingsStartDate.value : null;
                const endDate = bookingsEndDate ? bookingsEndDate.value : null;
                const status = bookingsStatusFilter ? bookingsStatusFilter.value : null;
                
                let bookings = await apiService.getAllBookings(
                    startDate ? new Date(startDate) : null,
                    endDate ? new Date(endDate) : null
                );
                
                // Filter by status if selected
                if (status) {
                    bookings = bookings.filter(booking => booking.status === status);
                }
                
                const tableBody = document.querySelector('#bookings-table tbody');
                if (!tableBody) return;
                
                tableBody.innerHTML = '';
                
                if (bookings.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="8" class="text-center">No bookings found</td></tr>';
                    return;
                }
                
                bookings.forEach(booking => {
                    const row = document.createElement('tr');
                    
                    // Debug logging to check the data structure
                    console.log('Booking data:', booking);
                    
                    row.innerHTML = `
                        <td>${booking.id}</td>
                        <td>${booking.userName || booking.User?.Name || 'N/A'}</td>
                        <td>${booking.type}</td>
                        <td>${booking.type === 'Class' ? booking.className : 'N/A' || booking.sessionName }</td>
                        <td>${booking.trainerName || 'N/A'}</td>
                        <td>${uiHelper.formatDate(booking.startTime)}</td>
                        <td>
                            <span class="badge ${
                                booking.status === 'Confirmed' ? 'bg-success' : 
                                booking.status === 'Cancelled' ? 'bg-danger' : 'bg-info'
                            }">
                                ${booking.status}
                            </span>
                        </td>
                        <td>
                            <div class="btn-group">
                                <button class="btn btn-sm btn-outline-primary view-booking-btn" data-id="${booking.id}">
                                    <i class="bi bi-eye"></i>
                                </button>
                                ${booking.status === 'Confirmed' ? `
                                    <button class="btn btn-sm btn-outline-danger cancel-booking-btn" data-id="${booking.id}">
                                        <i class="bi bi-x-circle"></i>
                                    </button>
                                ` : ''}
                            </div>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                });
                
                // Add event listeners
                document.querySelectorAll('.view-booking-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const bookingId = this.getAttribute('data-id');
                        viewBookingDetails(bookingId);
                    });
                });
                
                document.querySelectorAll('.cancel-booking-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const bookingId = this.getAttribute('data-id');
                        cancelBooking(bookingId);
                    });
                });
            } catch (error) {
                console.error('Error loading bookings:', error);
                const tableBody = document.querySelector('#bookings-table tbody');
                if (tableBody) {
                    tableBody.innerHTML = '<tr><td colspan="8" class="text-center text-danger">Error loading bookings</td></tr>';
                }
            }
        }
        
        async function viewBookingDetails(bookingId) {
            try {
                const booking = await apiService.getBookingDetails(bookingId);
                console.log('Booking details:', booking); // Debug log
                
                // Create a modal to show booking details
                const modalHtml = `
                    <div class="modal fade" id="bookingDetailsModal" tabindex="-1" aria-labelledby="bookingDetailsModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="bookingDetailsModalLabel">Booking Details</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <div class="mb-3">
                                        <strong>Booking ID:</strong> ${booking.id}
                                    </div>
                                    <div class="mb-3">
                                        <strong>User:</strong> ${booking.userName || booking.User?.Name || 'N/A'}
                                    </div>
                                    <div class="mb-3">
                                        <strong>User Email:</strong> ${booking.userEmail || booking.User?.Email || 'N/A'}
                                    </div>
                                    <div class="mb-3">
                                        <strong>Type:</strong> ${booking.type}
                                    </div>
                                    <div class="mb-3">
                                        <strong>${booking.type === 'Class' ? 'Class' : 'Session'}:</strong> ${booking.type === 'Class' ? (booking.className || 'N/A') : (booking.sessionName || 'N/A')}
                                    </div>
                                    <div class="mb-3">
                                        <strong>Trainer:</strong> ${booking.trainerName || 'N/A'}
                                    </div>
                                    <div class="mb-3">
                                        <strong>Date & Time:</strong> ${uiHelper.formatDate(booking.startTime)} - ${uiHelper.formatDate(booking.endTime)}
                                    </div>
                                    <div class="mb-3">
                                        <strong>Location:</strong> ${booking.location || 'N/A'}
                                    </div>
                                    <div class="mb-3">
                                        <strong>Booking Date:</strong> ${uiHelper.formatDate(booking.bookingDate)}
                                    </div>
                                    <div class="mb-3">
                                        <strong>Status:</strong> 
                                        <span class="badge ${
                                            booking.status === 'Confirmed' ? 'bg-success' : 
                                            booking.status === 'Cancelled' ? 'bg-danger' : 'bg-info'
                                        }">
                                            ${booking.status}
                                        </span>
                                    </div>
                                    <div class="mb-3">
                                        <strong>Hours Consumed:</strong> ${booking.hoursConsumed || 'N/A'}
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Add modal to DOM
                const modalContainer = document.createElement('div');
                modalContainer.innerHTML = modalHtml;
                document.body.appendChild(modalContainer);
                
                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('bookingDetailsModal'));
                modal.show();
                
                // Remove modal from DOM when hidden
                document.getElementById('bookingDetailsModal').addEventListener('hidden.bs.modal', function() {
                    document.body.removeChild(modalContainer);
                });
            } catch (error) {
                console.error('Error loading booking details:', error);
                uiHelper.showAlert('Error loading booking details', 'danger');
            }
        }
        
        // Cancel booking
        function cancelBooking(bookingId) {
            uiHelper.confirm('Are you sure you want to cancel this booking?', async function() {
                try {
                    // Note: This would require an API endpoint to cancel bookings
                    // For now, we'll just show a success message
                    uiHelper.showAlert('Booking cancelled successfully', 'success');
                    loadBookings();
                } catch (error) {
                    console.error('Error cancelling booking:', error);
                    uiHelper.showAlert('Error cancelling booking', 'danger');
                }
            });
        }
        
        // Load classes
        async function loadClasses() {
            try {
                const classes = await apiService.getClasses();
                
                const tableBody = document.querySelector('#classes-table tbody');
                if (!tableBody) return;
                
                tableBody.innerHTML = '';
                
                if (classes.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="8" class="text-center">No classes found</td></tr>';
                    return;
                }
                
                classes.forEach(classObj => {
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
    <td>${classObj.id}</td>
    <td>${classObj.name}</td>
    <td>${classObj.description}</td>
    <td>${classObj.trainerName}</td>
    <td>${classObj.duration} min</td>
    <td>${classObj.maxCapacity}</td>
    <td>${uiHelper.formatCurrency(classObj.price)}</td>
    <td>
        <div class="btn-group">
            <button class="btn btn-sm btn-outline-primary view-class-btn" data-id="${classObj.id}">
                <i class="bi bi-eye"></i>
            </button>
            <button class="btn btn-sm btn-outline-secondary edit-class-btn" data-id="${classObj.id}">
                <i class="bi bi-pencil"></i>
            </button>
            <button class="btn btn-sm btn-outline-danger delete-class-btn" data-id="${classObj.id}">
                <i class="bi bi-trash"></i>
            </button>
            <button class="btn btn-sm btn-outline-info view-schedules-btn" data-id="${classObj.id}">
                <i class="bi bi-calendar3"></i>
            </button>
        </div>
    </td>
`;
                    
                    tableBody.appendChild(row);
                });
                
                // Add event listeners
                document.querySelectorAll('.view-class-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const classId = this.getAttribute('data-id');
                        viewClassDetails(classId);
                    });
                });
                
                document.querySelectorAll('.edit-class-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const classId = this.getAttribute('data-id');
                        openClassModal(classId);
                    });
                });
                
                document.querySelectorAll('.delete-class-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const classId = this.getAttribute('data-id');
                        deleteClass(classId);
                    });
                });
                
                document.querySelectorAll('.view-schedules-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const classId = this.getAttribute('data-id');
                        viewClassSchedules(classId);
                    });
                });
            } catch (error) {
                console.error('Error loading classes:', error);
                const tableBody = document.querySelector('#classes-table tbody');
                if (tableBody) {
                    tableBody.innerHTML = '<tr><td colspan="8" class="text-center text-danger">Error loading classes</td></tr>';
                }
            }
        }
        
        // View class details
        async function viewClassDetails(classId) {
            try {
                const classObj = await apiService.getClassById(classId);
                
                // Create a modal to show class details
                const modalHtml = `
    <div class="modal fade" id="classDetailsModal" tabindex="-1" aria-labelledby="classDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="classDetailsModalLabel">Class Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <strong>ID:</strong> ${classObj.id}
                    </div>
                    <div class="mb-3">
                        <strong>Name:</strong> ${classObj.name}
                    </div>
                    <div class="mb-3">
                        <strong>Description:</strong> ${classObj.description}
                    </div>
                    <div class="mb-3">
                        <strong>Trainer:</strong> ${classObj.trainerName}
                    </div>
                    <div class="mb-3">
                        <strong>Duration:</strong> ${classObj.duration} minutes
                    </div>
                    <div class="mb-3">
                        <strong>Max Capacity:</strong> ${classObj.maxCapacity}
                    </div>
                    <div class="mb-3">
                        <strong>Price:</strong> ${uiHelper.formatCurrency(classObj.price)}
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
`;
                
                // Add modal to DOM
                const modalContainer = document.createElement('div');
                modalContainer.innerHTML = modalHtml;
                document.body.appendChild(modalContainer);
                
                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('classDetailsModal'));
                modal.show();
                
                // Remove modal from DOM when hidden
                document.getElementById('classDetailsModal').addEventListener('hidden.bs.modal', function() {
                    document.body.removeChild(modalContainer);
                });
            } catch (error) {
                console.error('Error loading class details:', error);
                uiHelper.showAlert('Error loading class details', 'danger');
            }
        }
        
        async function viewClassSchedules(classId) {
            try {
                const classObj = await apiService.getClassById(classId);
                const schedules = await apiService.getClassSchedules(classId);
                
                // Create a modal to show class schedules
                const modalHtml = `
    <div class="modal fade" id="classSchedulesModal" tabindex="-1" aria-labelledby="classSchedulesModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header d-flex justify-content-between align-items-center">
                    <h5 class="modal-title" id="classSchedulesModalLabel">Schedules for ${classObj.name}</h5>
                    <button type="button" class="btn btn-primary btn-sm" id="create-class-schedule-btn" data-class-id="${classId}">
                        <i class="bi bi-plus-circle"></i> Create Schedule
                    </button>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Start Time</th>
                                    <th>End Time</th>
                                    <th>Location</th>
                                    <th>Available Slots</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${schedules.length === 0 ? 
                                    '<tr><td colspan="6" class="text-center">No schedules found</td></tr>' :
                                    schedules.map(schedule => `
                                        <tr>
                                            <td>${schedule.id}</td>
                                            <td>${uiHelper.formatDate(schedule.startTime)}</td>
                                            <td>${uiHelper.formatDate(schedule.endTime)}</td>
                                            <td>${schedule.location}</td>
                                            <td>${schedule.availableSlots} / ${schedule.maxCapacity}</td>
                                            <td>
                                                <div class="btn-group">
                                                    <button class="btn btn-sm btn-outline-danger delete-schedule-btn" data-id="${schedule.id}" data-type="class">
                                                        <i class="bi bi-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    `).join('')
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
`;
                
                // Add modal to DOM
                const modalContainer = document.createElement('div');
                modalContainer.innerHTML = modalHtml;
                document.body.appendChild(modalContainer);
                
                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('classSchedulesModal'));
                modal.show();
                
                // Add event listeners to delete buttons
                modalContainer.querySelectorAll('.delete-schedule-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const scheduleId = this.getAttribute('data-id');
                        const type = this.getAttribute('data-type');
                        deleteSchedule(scheduleId, type);
                    });
                });
                
                // Add event listener to create schedule button
                const createScheduleBtn = modalContainer.querySelector('#create-class-schedule-btn');
                if (createScheduleBtn) {
                    createScheduleBtn.addEventListener('click', function() {
                        const classId = this.getAttribute('data-class-id');
                        openCreateClassScheduleModal(classId);
                    });
                }
                
                // Remove modal from DOM when hidden
                document.getElementById('classSchedulesModal').addEventListener('hidden.bs.modal', function() {
                    document.body.removeChild(modalContainer);
                });
            } catch (error) {
                console.error('Error loading class schedules:', error);
                uiHelper.showAlert('Error loading class schedules', 'danger');
            }
        }
        
        // Delete class
        function deleteClass(classId) {
            uiHelper.confirm('Are you sure you want to delete this class? This action cannot be undone.', async function() {
                try {
                    await apiService.deleteClass(classId);
                    uiHelper.showAlert('Class deleted successfully', 'success');
                    loadClasses();
                } catch (error) {
                    console.error('Error deleting class:', error);
                    uiHelper.showAlert('Error deleting class', 'danger');
                }
            });
        }
        
        // Open class modal (create or edit)
        async function openClassModal(classId = null) {
            try {
                // Load trainers for the dropdown
                const trainers = await apiService.getTrainers();
                const trainerSelect = document.getElementById('class-trainer');
                if (!trainerSelect) return;
                
                trainerSelect.innerHTML = '<option value="">Select Trainer</option>';
                
                trainers.forEach(trainer => {
                    const option = document.createElement('option');
                    option.value = trainer.id;
                    option.textContent = trainer.name;
                    trainerSelect.appendChild(option);
                });
                
                // Reset form
                const classForm = document.getElementById('class-form');
                if (classForm) classForm.reset();
                
                const classIdInput = document.getElementById('class-id');
                if (classIdInput) classIdInput.value = '';
                
                const modalLabel = document.getElementById('classModalLabel');
                if (!modalLabel) return;
                
                if (classId) {
                    // Edit mode
                    modalLabel.textContent = 'Edit Class';
                    
                    // Load class data
                    const classObj = await apiService.getClassById(classId);
                    
                    if (classIdInput) classIdInput.value = classObj.id;
                    document.getElementById('class-name').value = classObj.name;
                    document.getElementById('class-description').value = classObj.description;
                    document.getElementById('class-trainer').value = classObj.trainerId;
                    document.getElementById('class-duration').value = classObj.duration;
                    document.getElementById('class-capacity').value = classObj.maxCapacity;
                    document.getElementById('class-price').value = classObj.price;
                } else {
                    // Create mode
                    modalLabel.textContent = 'Create New Class';
                }
                
                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('classModal'));
                modal.show();
            } catch (error) {
                console.error('Error opening class modal:', error);
                uiHelper.showAlert('Error opening class modal', 'danger');
            }
        }
        
        // Save class
        async function saveClass() {
            try {
                const classIdInput = document.getElementById('class-id');
                const classId = classIdInput ? classIdInput.value : null;
                
                const classData = {
                    name: document.getElementById('class-name').value,
                    description: document.getElementById('class-description').value,
                    trainerId: parseInt(document.getElementById('class-trainer').value),
                    duration: parseInt(document.getElementById('class-duration').value),
                    maxCapacity: parseInt(document.getElementById('class-capacity').value),
                    price: parseFloat(document.getElementById('class-price').value)
                };
                
                // Validate form
                const classForm = document.getElementById('class-form');
                if (!formValidator.validateForm(classForm, {
                    'class-name': { required: true },
                    'class-description': { required: true },
                    'class-trainer': { required: true },
                    'class-duration': { required: true, min: 15 },
                    'class-capacity': { required: true, min: 1 },
                    'class-price': { required: true, min: 0 }
                })) {
                    return;
                }
                
                if (classId) {
                    // Update existing class
                    await apiService.updateClass(parseInt(classId), classData);
                    uiHelper.showAlert('Class updated successfully', 'success');
                } else {
                    // Create new class
                    await apiService.createClass(classData);
                    uiHelper.showAlert('Class created successfully', 'success');
                }
                
                // Hide modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('classModal'));
                if (modal) modal.hide();
                
                // Reload classes
                loadClasses();
            } catch (error) {
                console.error('Error saving class:', error);
                uiHelper.showAlert('Error saving class', 'danger');
            }
        }
        
        // Load online sessions
        async function loadSessions() {
            try {
                const sessions = await apiService.getSessions();
                
                const tableBody = document.querySelector('#sessions-table tbody');
                if (!tableBody) return;
                
                tableBody.innerHTML = '';
                
                if (sessions.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="7" class="text-center">No sessions found</td></tr>';
                    return;
                }
                
                sessions.forEach(session => {
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
    <td>${session.id}</td>
    <td>${session.name}</td>
    <td>${session.description}</td>
    <td>${session.trainerName}</td>
    <td>${session.duration} min</td>
    <td>${uiHelper.formatCurrency(session.price)}</td>
    <td>
        <div class="btn-group">
            <button class="btn btn-sm btn-outline-primary view-session-btn" data-id="${session.id}">
                <i class="bi bi-eye"></i>
            </button>
            <button class="btn btn-sm btn-outline-secondary edit-session-btn" data-id="${session.id}">
                <i class="bi bi-pencil"></i>
            </button>
            <button class="btn btn-sm btn-outline-danger delete-session-btn" data-id="${session.id}">
                <i class="bi bi-trash"></i>
            </button>
            <button class="btn btn-sm btn-outline-info view-session-schedules-btn" data-id="${session.id}">
                <i class="bi bi-calendar3"></i>
            </button>
        </div>
    </td>
`;
                    
                    tableBody.appendChild(row);
                });
                
                // Add event listeners
                document.querySelectorAll('.view-session-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const sessionId = this.getAttribute('data-id');
                        viewSessionDetails(sessionId);
                    });
                });
                
                document.querySelectorAll('.edit-session-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const sessionId = this.getAttribute('data-id');
                        openSessionModal(sessionId);
                    });
                });
                
                document.querySelectorAll('.delete-session-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const sessionId = this.getAttribute('data-id');
                        deleteSession(sessionId);
                    });
                });
                
                document.querySelectorAll('.view-session-schedules-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const sessionId = this.getAttribute('data-id');
                        viewSessionSchedules(sessionId);
                    });
                });
            } catch (error) {
                console.error('Error loading sessions:', error);
                const tableBody = document.querySelector('#sessions-table tbody');
                if (tableBody) {
                    tableBody.innerHTML = '<tr><td colspan="7" class="text-center text-danger">Error loading sessions</td></tr>';
                }
            }
        }
        
        // View session details
        async function viewSessionDetails(sessionId) {
            try {
                const session = await apiService.getSessionById(sessionId);
                
                // Create a modal to show session details
                const modalHtml = `
    <div class="modal fade" id="sessionDetailsModal" tabindex="-1" aria-labelledby="sessionDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="sessionDetailsModalLabel">Online Session Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <strong>ID:</strong> ${session.id}
                    </div>
                    <div class="mb-3">
                        <strong>Name:</strong> ${session.name}
                    </div>
                    <div class="mb-3">
                        <strong>Description:</strong> ${session.description}
                    </div>
                    <div class="mb-3">
                        <strong>Trainer:</strong> ${session.trainerName}
                    </div>
                    <div class="mb-3">
                        <strong>Duration:</strong> ${session.duration} minutes
                    </div>
                    <div class="mb-3">
                        <strong>Price:</strong> ${uiHelper.formatCurrency(session.price)}
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
`;
                
                // Add modal to DOM
                const modalContainer = document.createElement('div');
                modalContainer.innerHTML = modalHtml;
                document.body.appendChild(modalContainer);
                
                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('sessionDetailsModal'));
                modal.show();
                
                // Remove modal from DOM when hidden
                document.getElementById('sessionDetailsModal').addEventListener('hidden.bs.modal', function() {
                    document.body.removeChild(modalContainer);
                });
            } catch (error) {
                console.error('Error loading session details:', error);
                uiHelper.showAlert('Error loading session details', 'danger');
            }
        }
        
        async function viewSessionSchedules(sessionId) {
            try {
                const session = await apiService.getSessionById(sessionId);
                const schedules = await apiService.getSessionSchedules(sessionId);
                
                // Create a modal to show session schedules
                const modalHtml = `
    <div class="modal fade" id="sessionSchedulesModal" tabindex="-1" aria-labelledby="sessionSchedulesModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header d-flex justify-content-between align-items-center">
                    <h5 class="modal-title" id="sessionSchedulesModalLabel">Schedules for ${session.name}</h5>
                    <button type="button" class="btn btn-primary btn-sm" id="create-session-schedule-btn" data-session-id="${sessionId}">
                        <i class="bi bi-plus-circle"></i> Create Schedule
                    </button>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Start Time</th>
                                    <th>End Time</th>
                                    <th>Available Slots</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${schedules.length === 0 ? 
                                    '<tr><td colspan="5" class="text-center">No schedules found</td></tr>' :
                                    schedules.map(schedule => `
                                        <tr>
                                            <td>${schedule.id}</td>
                                            <td>${uiHelper.formatDate(schedule.startTime)}</td>
                                            <td>${uiHelper.formatDate(schedule.endTime)}</td>
                                            <td>${schedule.availableSlots} / ${schedule.maxSlots}</td>
                                            <td>
                                                <div class="btn-group">
                                                    <button class="btn btn-sm btn-outline-danger delete-schedule-btn" data-id="${schedule.id}" data-type="session">
                                                        <i class="bi bi-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    `).join('')
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
`;
                
                // Add modal to DOM
                const modalContainer = document.createElement('div');
                modalContainer.innerHTML = modalHtml;
                document.body.appendChild(modalContainer);
                
                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('sessionSchedulesModal'));
                modal.show();
                
                // Add event listeners to delete buttons
                modalContainer.querySelectorAll('.delete-schedule-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const scheduleId = this.getAttribute('data-id');
                        const type = this.getAttribute('data-type');
                        deleteSchedule(scheduleId, type);
                    });
                });
                
                // Add event listener to create schedule button
                const createScheduleBtn = modalContainer.querySelector('#create-session-schedule-btn');
                if (createScheduleBtn) {
                    createScheduleBtn.addEventListener('click', function() {
                        const sessionId = this.getAttribute('data-session-id');
                        openCreateSessionScheduleModal(sessionId);
                    });
                }
                
                // Remove modal from DOM when hidden
                document.getElementById('sessionSchedulesModal').addEventListener('hidden.bs.modal', function() {
                    document.body.removeChild(modalContainer);
                });
            } catch (error) {
                console.error('Error loading session schedules:', error);
                uiHelper.showAlert('Error loading session schedules', 'danger');
            }
        }
        
        // Update your openCreateClassScheduleModal function
        async function openCreateClassScheduleModal(classId) {
            try {
                // Reset form
                const form = document.getElementById('create-class-schedule-form');
                if (form) form.reset();
                
                // Set class ID
                document.getElementById('schedule-class-id').value = classId;
                
                // Get the modal element
                const modalElement = document.getElementById('createClassScheduleModal');
                
                // Add event listener for when the modal is shown
                modalElement.addEventListener('shown.bs.modal', function () {
                    // Set a higher z-index for this modal
                    this.classList.add('modal-high-zindex');
                    
                    // Adjust the backdrop z-index
                    const backdrops = document.querySelectorAll('.modal-backdrop');
                    if (backdrops.length > 0) {
                        const backdrop = backdrops[backdrops.length - 1];
                        backdrop.classList.add('modal-backdrop-high-zindex');
                    }
                }, { once: true }); // Use once: true to remove the event listener after it fires
                
                // Show modal
                const modal = new bootstrap.Modal(modalElement);
                modal.show();
            } catch (error) {
                console.error('Error opening create class schedule modal:', error);
                uiHelper.showAlert('Error opening create schedule modal', 'danger');
            }
        }
        
        // Update your openCreateSessionScheduleModal function
        async function openCreateSessionScheduleModal(sessionId) {
            try {
                // Reset form
                const form = document.getElementById('create-session-schedule-form');
                if (form) form.reset();
                
                // Set session ID
                document.getElementById('session-schedule-session-id').value = sessionId;
                
                // Get the modal element
                const modalElement = document.getElementById('createSessionScheduleModal');
                
                // Add event listener for when the modal is shown
                modalElement.addEventListener('shown.bs.modal', function () {
                    // Set a higher z-index for this modal
                    this.classList.add('modal-high-zindex');
                    
                    // Adjust the backdrop z-index
                    const backdrops = document.querySelectorAll('.modal-backdrop');
                    if (backdrops.length > 0) {
                        const backdrop = backdrops[backdrops.length - 1];
                        backdrop.classList.add('modal-backdrop-high-zindex');
                    }
                }, { once: true }); // Use once: true to remove the event listener after it fires
                
                // Show modal
                const modal = new bootstrap.Modal(modalElement);
                modal.show();
            } catch (error) {
                console.error('Error opening create session schedule modal:', error);
                uiHelper.showAlert('Error opening create schedule modal', 'danger');
            }
        }
        
        // Save Class Schedule
        async function saveClassSchedule() {
            try {
                const classId = document.getElementById('schedule-class-id').value;
                const startTime = document.getElementById('schedule-start-time').value;
                const endTime = document.getElementById('schedule-end-time').value;
                const location = document.getElementById('schedule-location').value;
                
                // Validate form
                if (!classId || !startTime || !endTime || !location) {
                    uiHelper.showAlert('Please fill all fields', 'warning');
                    return;
                }
                
                // Validate date range
                if (new Date(startTime) >= new Date(endTime)) {
                    uiHelper.showAlert('End time must be after start time', 'warning');
                    return;
                }
                
                const scheduleData = {
                    classId: parseInt(classId),
                    startTime: new Date(startTime).toISOString(),
                    endTime: new Date(endTime).toISOString(),
                    location: location
                };
                
                // Create schedule
                await apiService.createClassSchedule(scheduleData);
                uiHelper.showAlert('Class schedule created successfully', 'success');
                
                // Hide modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('createClassScheduleModal'));
                if (modal) modal.hide();
                
                // Refresh schedules list
                const classSchedulesModal = document.getElementById('classSchedulesModal');
                if (classSchedulesModal) {
                    const currentClassId = document.querySelector('#create-class-schedule-btn').getAttribute('data-class-id');
                    viewClassSchedules(currentClassId);
                }
            } catch (error) {
                console.error('Error saving class schedule:', error);
                uiHelper.showAlert('Error saving class schedule: ' + error.message, 'danger');
            }
        }
        
        // Save Session Schedule
        async function saveSessionSchedule() {
            try {
                const sessionId = document.getElementById('session-schedule-session-id').value;
                const startTime = document.getElementById('session-schedule-start-time').value;
                const endTime = document.getElementById('session-schedule-end-time').value;
                const availableSlots = document.getElementById('session-schedule-slots').value;
                
                // Validate form
                if (!sessionId || !startTime || !endTime || !availableSlots) {
                    uiHelper.showAlert('Please fill all fields', 'warning');
                    return;
                }
                
                // Validate date range
                if (new Date(startTime) >= new Date(endTime)) {
                    uiHelper.showAlert('End time must be after start time', 'warning');
                    return;
                }
                
                const scheduleData = {
                    onlineSessionId: parseInt(sessionId),
                    startTime: new Date(startTime).toISOString(),
                    endTime: new Date(endTime).toISOString(),
                    availableSlots: parseInt(availableSlots)
                };
                
                // Create schedule
                await apiService.createSessionSchedule(scheduleData);
                uiHelper.showAlert('Session schedule created successfully', 'success');
                
                // Hide modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('createSessionScheduleModal'));
                if (modal) modal.hide();
                
                // Refresh schedules list
                const sessionSchedulesModal = document.getElementById('sessionSchedulesModal');
                if (sessionSchedulesModal) {
                    const currentSessionId = document.querySelector('#create-session-schedule-btn').getAttribute('data-session-id');
                    viewSessionSchedules(currentSessionId);
                }
            } catch (error) {
                console.error('Error saving session schedule:', error);
                uiHelper.showAlert('Error saving session schedule: ' + error.message, 'danger');
            }
        }
        
        // Delete session
        function deleteSession(sessionId) {
            uiHelper.confirm('Are you sure you want to delete this session? This action cannot be undone.', async function() {
                try {
                    await apiService.deleteSession(sessionId);
                    uiHelper.showAlert('Session deleted successfully', 'success');
                    loadSessions();
                } catch (error) {
                    console.error('Error deleting session:', error);
                    uiHelper.showAlert('Error deleting session', 'danger');
                }
            });
        }
        
        // Delete schedule (class or session)
        function deleteSchedule(scheduleId, type) {
            uiHelper.confirm('Are you sure you want to delete this schedule? This action cannot be undone.', async function() {
                try {
                    if (type === 'class') {
                        await apiService.deleteClassSchedule(scheduleId);
                    } else {
                        await apiService.deleteSessionSchedule(scheduleId);
                    }
                    uiHelper.showAlert('Schedule deleted successfully', 'success');
                    
                    // Close the modal and reload the data
                    const modal = bootstrap.Modal.getInstance(
                        type === 'class' ? 
                        document.getElementById('classSchedulesModal') : 
                        document.getElementById('sessionSchedulesModal')
                    );
                    if (modal) modal.hide();
                    
                    if (type === 'class') {
                        loadClasses();
                    } else {
                        loadSessions();
                    }
                } catch (error) {
                    console.error('Error deleting schedule:', error);
                    uiHelper.showAlert('Error deleting schedule', 'danger');
                }
            });
        }
        
        // Open session modal (create or edit)
        async function openSessionModal(sessionId = null) {
            try {
                // Load trainers for the dropdown
                const trainers = await apiService.getTrainers();
                const trainerSelect = document.getElementById('session-trainer');
                if (!trainerSelect) return;
                
                trainerSelect.innerHTML = '<option value="">Select Trainer</option>';
                
                trainers.forEach(trainer => {
                    const option = document.createElement('option');
                    option.value = trainer.id;
                    option.textContent = trainer.name;
                    trainerSelect.appendChild(option);
                });
                
                // Reset form
                const sessionForm = document.getElementById('session-form');
                if (sessionForm) sessionForm.reset();
                
                const sessionIdInput = document.getElementById('session-id');
                if (sessionIdInput) sessionIdInput.value = '';
                
                const modalLabel = document.getElementById('sessionModalLabel');
                if (!modalLabel) return;
                
                if (sessionId) {
                    // Edit mode
                    modalLabel.textContent = 'Edit Online Session';
                    
                    // Load session data
                    const session = await apiService.getSessionById(sessionId);
                    
                    if (sessionIdInput) sessionIdInput.value = session.id;
                    document.getElementById('session-name').value = session.name;
                    document.getElementById('session-description').value = session.description;
                    document.getElementById('session-trainer').value = session.trainerId;
                    document.getElementById('session-duration').value = session.duration;
                    document.getElementById('session-price').value = session.price;
                } else {
                    // Create mode
                    modalLabel.textContent = 'Create New Online Session';
                }
                
                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('sessionModal'));
                modal.show();
            } catch (error) {
                console.error('Error opening session modal:', error);
                uiHelper.showAlert('Error opening session modal', 'danger');
            }
        }
        
        // Save session
        async function saveSession() {
            try {
                const sessionIdInput = document.getElementById('session-id');
                const sessionId = sessionIdInput ? sessionIdInput.value : null;
                
                const sessionData = {
                    name: document.getElementById('session-name').value,
                    description: document.getElementById('session-description').value,
                    trainerId: parseInt(document.getElementById('session-trainer').value),
                    duration: parseInt(document.getElementById('session-duration').value),
                    price: parseFloat(document.getElementById('session-price').value)
                };
                
                // Validate form
                const sessionForm = document.getElementById('session-form');
                if (!formValidator.validateForm(sessionForm, {
                    'session-name': { required: true },
                    'session-description': { required: true },
                    'session-trainer': { required: true },
                    'session-duration': { required: true, min: 15 },
                    'session-price': { required: true, min: 0 }
                })) {
                    return;
                }
                
                if (sessionId) {
                    // Update existing session
                    await apiService.updateSession(parseInt(sessionId), sessionData);
                    uiHelper.showAlert('Session updated successfully', 'success');
                } else {
                    // Create new session
                    await apiService.createSession(sessionData);
                    uiHelper.showAlert('Session created successfully', 'success');
                }
                
                // Hide modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('sessionModal'));
                if (modal) modal.hide();
                
                // Reload sessions
                loadSessions();
            } catch (error) {
                console.error('Error saving session:', error);
                uiHelper.showAlert('Error saving session', 'danger');
            }
        }
        
        // Load trainers
        async function loadTrainers() {
            try {
                const trainers = await apiService.getTrainers();
                
                const tableBody = document.querySelector('#trainers-table tbody');
                if (!tableBody) return;
                
                tableBody.innerHTML = '';
                
                if (trainers.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="6" class="text-center">No trainers found</td></tr>';
                    return;
                }
                
                trainers.forEach(trainer => {
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${trainer.id}</td>
                        <td>${trainer.name}</td>
                        <td>${trainer.specialization}</td>
                        <td>${trainer.experienceYears} years</td>
                        <td>${trainer.certifications || 'N/A'}</td>
                        <td>
                            <div class="btn-group">
                                <button class="btn btn-sm btn-outline-primary view-trainer-btn" data-id="${trainer.id}">
                                    <i class="bi bi-eye"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-secondary edit-trainer-btn" data-id="${trainer.id}">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger delete-trainer-btn" data-id="${trainer.id}">
                                    <i class="bi bi-trash"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-info view-trainer-classes-btn" data-id="${trainer.id}">
                                    <i class="bi bi-calendar-event"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-info view-trainer-sessions-btn" data-id="${trainer.id}">
                                    <i class="bi bi-laptop"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                });
                
                // Add event listeners
                document.querySelectorAll('.view-trainer-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const trainerId = this.getAttribute('data-id');
                        viewTrainerDetails(trainerId);
                    });
                });
                
                document.querySelectorAll('.edit-trainer-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const trainerId = this.getAttribute('data-id');
                        openTrainerModal(trainerId);
                    });
                });
                
                document.querySelectorAll('.delete-trainer-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const trainerId = this.getAttribute('data-id');
                        deleteTrainer(trainerId);
                    });
                });
                
                document.querySelectorAll('.view-trainer-classes-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const trainerId = this.getAttribute('data-id');
                        viewTrainerClasses(trainerId);
                    });
                });
                
                document.querySelectorAll('.view-trainer-sessions-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const trainerId = this.getAttribute('data-id');
                        viewTrainerSessions(trainerId);
                    });
                });
            } catch (error) {
                console.error('Error loading trainers:', error);
                const tableBody = document.querySelector('#trainers-table tbody');
                if (tableBody) {
                    tableBody.innerHTML = '<tr><td colspan="6" class="text-center text-danger">Error loading trainers</td></tr>';
                }
            }
        }
        
        // View trainer details
        async function viewTrainerDetails(trainerId) {
            try {
                const trainer = await apiService.getTrainerById(trainerId);
                
                // Create a modal to show trainer details
                const modalHtml = `
                    <div class="modal fade" id="trainerDetailsModal" tabindex="-1" aria-labelledby="trainerDetailsModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="trainerDetailsModalLabel">Trainer Details</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <div class="mb-3">
                                        <strong>ID:</strong> ${trainer.id}
                                    </div>
                                    <div class="mb-3">
                                        <strong>Name:</strong> ${trainer.name}
                                    </div>
                                    <div class="mb-3">
                                        <strong>Specialization:</strong> ${trainer.specialization}
                                    </div>
                                    <div class="mb-3">
                                        <strong>Experience:</strong> ${trainer.experienceYears} years
                                    </div>
                                    <div class="mb-3">
                                        <strong>Certifications:</strong> ${trainer.certifications || 'N/A'}
                                    </div>
                                    <div class="mb-3">
                                        <strong>Bio:</strong> ${trainer.bio}
                                    </div>
                                    ${trainer.imageUrl ? `
                                        <div class="mb-3">
                                            <strong>Image:</strong><br>
                                            <img src="${getImageUrl(trainer.imageUrl)}" alt="${trainer.name}" class="img-thumbnail" style="max-width: 200px;">
                                        </div>
                                    ` : ''}
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Add modal to DOM
                const modalContainer = document.createElement('div');
                modalContainer.innerHTML = modalHtml;
                document.body.appendChild(modalContainer);
                
                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('trainerDetailsModal'));
                modal.show();
                
                // Remove modal from DOM when hidden
                document.getElementById('trainerDetailsModal').addEventListener('hidden.bs.modal', function() {
                    document.body.removeChild(modalContainer);
                });
            } catch (error) {
                console.error('Error loading trainer details:', error);
                uiHelper.showAlert('Error loading trainer details', 'danger');
            }
        }
        
        // View trainer classes
        async function viewTrainerClasses(trainerId) {
            try {
                const trainer = await apiService.getTrainerById(trainerId);
                const classes = await apiService.getTrainerClasses(trainerId);
                
                // Create a modal to show trainer classes
                const modalHtml = `
    <div class="modal fade" id="trainerClassesModal" tabindex="-1" aria-labelledby="trainerClassesModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="trainerClassesModalLabel">Classes by ${trainer.name}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Description</th>
                                    <th>Duration (min)</th>
                                    <th>Capacity</th>
                                    <th>Price</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${classes.length === 0 ? 
                                    '<tr><td colspan="6" class="text-center">No classes found</td></tr>' :
                                    classes.map(classObj => `
                                        <tr>
                                            <td>${classObj.id}</td>
                                            <td>${classObj.name}</td>
                                            <td>${classObj.description}</td>
                                            <td>${classObj.duration} min</td>
                                            <td>${classObj.maxCapacity}</td>
                                            <td>${uiHelper.formatCurrency(classObj.price)}</td>
                                        </tr>
                                    `).join('')
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
`;
                
                // Add modal to DOM
                const modalContainer = document.createElement('div');
                modalContainer.innerHTML = modalHtml;
                document.body.appendChild(modalContainer);
                
                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('trainerClassesModal'));
                modal.show();
                
                // Remove modal from DOM when hidden
                document.getElementById('trainerClassesModal').addEventListener('hidden.bs.modal', function() {
                    document.body.removeChild(modalContainer);
                });
            } catch (error) {
                console.error('Error loading trainer classes:', error);
                uiHelper.showAlert('Error loading trainer classes', 'danger');
            }
        }
        
        // View trainer sessions
        async function viewTrainerSessions(trainerId) {
            try {
                const trainer = await apiService.getTrainerById(trainerId);
                const sessions = await apiService.getTrainerSessions(trainerId);
                
                // Create a modal to show trainer sessions
                const modalHtml = `
    <div class="modal fade" id="trainerSessionsModal" tabindex="-1" aria-labelledby="trainerSessionsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="trainerSessionsModalLabel">Online Sessions by ${trainer.name}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Description</th>
                                    <th>Duration (min)</th>
                                    <th>Price</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${sessions.length === 0 ? 
                                    '<tr><td colspan="5" class="text-center">No sessions found</td></tr>' :
                                    sessions.map(session => `
                                        <tr>
                                            <td>${session.id}</td>
                                            <td>${session.name}</td>
                                            <td>${session.description}</td>
                                            <td>${session.duration} min</td>
                                            <td>${uiHelper.formatCurrency(session.price)}</td>
                                        </tr>
                                    `).join('')
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
`;
                
                // Add modal to DOM
                const modalContainer = document.createElement('div');
                modalContainer.innerHTML = modalHtml;
                document.body.appendChild(modalContainer);
                
                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('trainerSessionsModal'));
                modal.show();
                
                // Remove modal from DOM when hidden
                document.getElementById('trainerSessionsModal').addEventListener('hidden.bs.modal', function() {
                    document.body.removeChild(modalContainer);
                });
            } catch (error) {
                console.error('Error loading trainer sessions:', error);
                uiHelper.showAlert('Error loading trainer sessions', 'danger');
            }
        }
        
        // Delete trainer
        function deleteTrainer(trainerId) {
            uiHelper.confirm('Are you sure you want to delete this trainer? This action cannot be undone.', async function() {
                try {
                    await apiService.deleteTrainer(trainerId);
                    uiHelper.showAlert('Trainer deleted successfully', 'success');
                    loadTrainers();
                } catch (error) {
                    console.error('Error deleting trainer:', error);
                    uiHelper.showAlert('Error deleting trainer', 'danger');
                }
            });
        }
        
        async function openTrainerModal(trainerId = null) {
            try {
                // Reset form
                const trainerForm = document.getElementById('trainer-form');
                if (trainerForm) trainerForm.reset();
                
                const trainerIdInput = document.getElementById('trainer-id');
                if (trainerIdInput) trainerIdInput.value = '';
                
                // Clear image preview but keep track of existing image
                const imagePreview = document.getElementById('trainer-image-preview');
                if (imagePreview) imagePreview.innerHTML = '';
                
                // Store existing image URL for update scenario
                let existingImageUrl = '';
                
                const modalLabel = document.getElementById('trainerModalLabel');
                if (!modalLabel) return;
                
                if (trainerId) {
                    // Edit mode
                    modalLabel.textContent = 'Edit Trainer';
                    
                    try {
                        // Load trainer data
                        const trainer = await apiService.getTrainerById(trainerId);
                        
                        if (trainerIdInput) trainerIdInput.value = trainer.id;
                        document.getElementById('trainer-name').value = trainer.name;
                        document.getElementById('trainer-specialization').value = trainer.specialization;
                        document.getElementById('trainer-experience').value = trainer.experienceYears;
                        document.getElementById('trainer-certifications').value = trainer.certifications || '';
                        document.getElementById('trainer-bio').value = trainer.bio;
                        
                        // Store existing image URL
                        existingImageUrl = trainer.imageUrl || '';
                        
                        // Show existing image if available
                        if (trainer.imageUrl) {
                            imagePreview.innerHTML = `
                                <div class="d-flex align-items-center">
                                    <img src="${getImageUrl(trainer.imageUrl)}" alt="${trainer.name}" class="img-thumbnail me-2" style="max-width: 100px;">
                                    <small class="text-muted">Current image</small>
                                </div>
                                <input type="hidden" id="existing-image-url" value="${trainer.imageUrl}">
                            `;
                        }
                    } catch (error) {
                        uiHelper.showAlert('Trainer not found', 'danger');
                        return;
                    }
                } else {
                    // Create mode
                    modalLabel.textContent = 'Create New Trainer';
                }
                
                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('trainerModal'));
                modal.show();
            } catch (error) {
                console.error('Error opening trainer modal:', error);
                uiHelper.showAlert('Error opening trainer modal: ' + error.message, 'danger');
            }
        }
        
        async function saveTrainer() {
            try {
                const trainerIdInput = document.getElementById('trainer-id');
                const trainerId = trainerIdInput ? trainerIdInput.value : null;
                
                const trainerData = {
                    name: document.getElementById('trainer-name').value,
                    specialization: document.getElementById('trainer-specialization').value,
                    experienceYears: parseInt(document.getElementById('trainer-experience').value),
                    certifications: document.getElementById('trainer-certifications').value,
                    bio: document.getElementById('trainer-bio').value
                };
                
                // Get image file
                const imageFileInput = document.getElementById('trainer-image-file');
                const imageFile = imageFileInput && imageFileInput.files.length > 0 ? imageFileInput.files[0] : null;
                
                // Validate form
                const trainerForm = document.getElementById('trainer-form');
                if (!formValidator.validateForm(trainerForm, {
                    'trainer-name': { required: true },
                    'trainer-specialization': { required: true },
                    'trainer-experience': { required: true, min: 0 },
                    'trainer-bio': { required: true }
                })) {
                    return;
                }
                
                if (trainerId) {
                    // Update existing trainer
                    await apiService.updateTrainer(parseInt(trainerId), trainerData, imageFile);
                    uiHelper.showAlert('Trainer updated successfully', 'success');
                } else {
                    // Create new trainer
                    await apiService.createTrainer(trainerData, imageFile);
                    uiHelper.showAlert('Trainer created successfully', 'success');
                }
                
                // Hide modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('trainerModal'));
                if (modal) modal.hide();
                
                // Reload trainers
                loadTrainers();
            } catch (error) {
                console.error('Error saving trainer:', error);
                uiHelper.showAlert('Error saving trainer: ' + error.message, 'danger');
            }
        }
        
        // Update the loadMemberships function to show all membership types
        async function loadMemberships() {
            try {
                // Pass true to include inactive membership types
                const memberships = await apiService.getMembershipTypes(true);
                
                const tableBody = document.querySelector('#memberships-table tbody');
                if (!tableBody) return;
                
                tableBody.innerHTML = '';
                
                if (memberships.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="8" class="text-center">No membership types found</td></tr>';
                    return;
                }
                
                memberships.forEach(membership => {
                    const row = document.createElement('tr');
                    
                    // Add a class to visually distinguish inactive memberships
                    if (!membership.isActive) {
                        row.classList.add('table-secondary');
                    }
                    
                    row.innerHTML = `
                        <td>${membership.id}</td>
                        <td>${membership.name}</td>
                        <td>${membership.description}</td>
                        <td>${membership.durationMonths} months</td>
                        <td>${membership.totalHours} hours</td>
                        <td>${uiHelper.formatCurrency(membership.price)}</td>
                        <td>
                            <span class="badge ${membership.isActive ? 'bg-success' : 'bg-secondary'}">
                                ${membership.isActive ? 'Active' : 'Inactive'}
                            </span>
                        </td>
                        <td>
                            <div class="btn-group">
                                <button class="btn btn-sm btn-outline-primary view-membership-btn" data-id="${membership.id}">
                                    <i class="bi bi-eye"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-secondary edit-membership-btn" data-id="${membership.id}">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger delete-membership-btn" data-id="${membership.id}">
                                    <i class="bi bi-trash"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-${membership.isActive ? 'warning' : 'success'} toggle-membership-btn" data-id="${membership.id}" data-active="${membership.isActive}" title="${membership.isActive ? 'Deactivate' : 'Activate'}">
                                    <i class="bi bi-${membership.isActive ? 'toggle-on' : 'toggle-off'}"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                });
                
                // Add event listeners
                document.querySelectorAll('.view-membership-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const membershipId = this.getAttribute('data-id');
                        viewMembershipDetails(membershipId);
                    });
                });
                
                document.querySelectorAll('.edit-membership-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const membershipId = this.getAttribute('data-id');
                        openMembershipModal(membershipId);
                    });
                });
                
                document.querySelectorAll('.delete-membership-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const membershipId = this.getAttribute('data-id');
                        deleteMembership(membershipId);
                    });
                });
                
                document.querySelectorAll('.toggle-membership-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const membershipId = this.getAttribute('data-id');
                        const isActive = this.getAttribute('data-active') === 'true';
                        toggleMembershipStatus(membershipId, !isActive);
                    });
                });
            } catch (error) {
                console.error('Error loading membership types:', error);
                const tableBody = document.querySelector('#memberships-table tbody');
                if (tableBody) {
                    tableBody.innerHTML = '<tr><td colspan="8" class="text-center text-danger">Error loading membership types</td></tr>';
                }
            }
        }
        
        // View membership details
        async function viewMembershipDetails(membershipId) {
            try {
                const membership = await apiService.getMembershipTypeById(membershipId);
                
                // Create a modal to show membership details
                const modalHtml = `
                    <div class="modal fade" id="membershipDetailsModal" tabindex="-1" aria-labelledby="membershipDetailsModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="membershipDetailsModalLabel">Membership Type Details</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <div class="mb-3">
                                        <strong>ID:</strong> ${membership.id}
                                    </div>
                                    <div class="mb-3">
                                        <strong>Name:</strong> ${membership.name}
                                    </div>
                                    <div class="mb-3">
                                        <strong>Description:</strong> ${membership.description}
                                    </div>
                                    <div class="mb-3">
                                        <strong>Duration:</strong> ${membership.durationMonths} months
                                    </div>
                                    <div class="mb-3">
                                        <strong>Total Hours:</strong> ${membership.totalHours}
                                    </div>
                                    <div class="mb-3">
                                        <strong>Price:</strong> ${uiHelper.formatCurrency(membership.price)}
                                    </div>
                                    <div class="mb-3">
                                        <strong>Status:</strong> 
                                        <span class="badge ${membership.isActive ? 'bg-success' : 'bg-secondary'}">
                                            ${membership.isActive ? 'Active' : 'Inactive'}
                                        </span>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Add modal to DOM
                const modalContainer = document.createElement('div');
                modalContainer.innerHTML = modalHtml;
                document.body.appendChild(modalContainer);
                
                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('membershipDetailsModal'));
                modal.show();
                
                // Remove modal from DOM when hidden
                document.getElementById('membershipDetailsModal').addEventListener('hidden.bs.modal', function() {
                    document.body.removeChild(modalContainer);
                });
            } catch (error) {
                console.error('Error loading membership details:', error);
                uiHelper.showAlert('Error loading membership details', 'danger');
            }
        }
        
        // Delete membership type
        function deleteMembership(membershipId) {
            uiHelper.confirm('Are you sure you want to delete this membership type? This action cannot be undone.', async function() {
                try {
                    await apiService.deleteMembershipType(membershipId);
                    uiHelper.showAlert('Membership type deleted successfully', 'success');
                    loadMemberships();
                } catch (error) {
                    console.error('Error deleting membership type:', error);
                    uiHelper.showAlert('Error deleting membership type', 'danger');
                }
            });
        }
        
        // Toggle membership status
        // Update the toggleMembershipStatus function to handle the UI update properly
        async function toggleMembershipStatus(membershipId, isActive) {
            try {
                await apiService.toggleMembershipTypeStatus(membershipId, isActive);
                uiHelper.showAlert(`Membership type ${isActive ? 'activated' : 'deactivated'} successfully`, 'success');
                
                // Update the button state without reloading the entire table
                const toggleButton = document.querySelector(`.toggle-membership-btn[data-id="${membershipId}"]`);
                if (toggleButton) {
                    // Update the button attributes
                    toggleButton.setAttribute('data-active', isActive);
                    toggleButton.setAttribute('title', isActive ? 'Deactivate' : 'Activate');
                    
                    // Update the button classes
                    toggleButton.classList.remove('btn-outline-warning', 'btn-outline-success');
                    toggleButton.classList.add(isActive ? 'btn-outline-warning' : 'btn-outline-success');
                    
                    // Update the button icon
                    const icon = toggleButton.querySelector('i');
                    icon.classList.remove('bi-toggle-on', 'bi-toggle-off');
                    icon.classList.add(isActive ? 'bi-toggle-on' : 'bi-toggle-off');
                    
                    // Update the status badge
                    const row = toggleButton.closest('tr');
                    const statusBadge = row.querySelector('td:nth-child(7) .badge');
                    if (statusBadge) {
                        statusBadge.classList.remove('bg-success', 'bg-secondary');
                        statusBadge.classList.add(isActive ? 'bg-success' : 'bg-secondary');
                        statusBadge.textContent = isActive ? 'Active' : 'Inactive';
                    }
                    
                    // Update the row styling
                    if (isActive) {
                        row.classList.remove('table-secondary');
                    } else {
                        row.classList.add('table-secondary');
                    }
                }
            } catch (error) {
                console.error('Error toggling membership status:', error);
                uiHelper.showAlert('Error toggling membership status: ' + error.message, 'danger');
            }
        }
        
        // Open membership modal (create or edit)
        async function openMembershipModal(membershipId = null) {
            try {
                // Reset form
                const membershipForm = document.getElementById('membership-form');
                if (membershipForm) membershipForm.reset();
                
                const membershipIdInput = document.getElementById('membership-id');
                if (membershipIdInput) membershipIdInput.value = '';
                
                const modalLabel = document.getElementById('membershipModalLabel');
                if (!modalLabel) return;
                
                if (membershipId) {
                    // Edit mode
                    modalLabel.textContent = 'Edit Membership Type';
                    
                    try {
                        // Load membership data
                        const membership = await apiService.getMembershipTypeById(membershipId);
                        
                        if (membershipIdInput) membershipIdInput.value = membership.id;
                        document.getElementById('membership-name').value = membership.name;
                        document.getElementById('membership-description').value = membership.description;
                        document.getElementById('membership-duration').value = membership.durationMonths;
                        document.getElementById('membership-hours').value = membership.totalHours;
                        document.getElementById('membership-price').value = membership.price;
                        document.getElementById('membership-active').checked = membership.isActive;
                    } catch (error) {
                        uiHelper.showAlert('Membership type not found', 'danger');
                        return;
                    }
                } else {
                    // Create mode
                    modalLabel.textContent = 'Create New Membership Type';
                }
                
                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('membershipModal'));
                modal.show();
            } catch (error) {
                console.error('Error opening membership modal:', error);
                uiHelper.showAlert('Error opening membership modal: ' + error.message, 'danger');
            }
        }
        
        // Save membership type
        async function saveMembership() {
            try {
                const membershipIdInput = document.getElementById('membership-id');
                const membershipId = membershipIdInput ? membershipIdInput.value : null;
                
                // Get form values and ensure they're properly formatted
                const name = document.getElementById('membership-name').value.trim();
                const description = document.getElementById('membership-description').value.trim();
                const durationMonths = parseInt(document.getElementById('membership-duration').value);
                const totalHours = parseFloat(document.getElementById('membership-hours').value);
                const price = parseFloat(document.getElementById('membership-price').value);
                
                // Validate each field individually
                if (!name) {
                    uiHelper.showAlert('Name is required', 'warning');
                    return;
                }
                
                if (!description) {
                    uiHelper.showAlert('Description is required', 'warning');
                    return;
                }
                
                if (isNaN(durationMonths) || durationMonths < 1 || durationMonths > 12) {
                    uiHelper.showAlert('Duration must be between 1 and 12 months', 'warning');
                    return;
                }
                
                if (isNaN(totalHours) || totalHours < 1 || totalHours > 100) {
                    uiHelper.showAlert('Total hours must be between 1 and 100', 'warning');
                    return;
                }
                
                if (isNaN(price) || price < 0) {
                    uiHelper.showAlert('Price must be a positive number', 'warning');
                    return;
                }
                
                // Create the data object with the correct property names (matching the backend DTO)
                const membershipData = {
                    name: name,                    // Using camelCase to match JavaScript convention
                    description: description,
                    durationMonths: durationMonths,
                    totalHours: totalHours,
                    price: price
                };
                
                console.log('Sending membership data:', JSON.stringify(membershipData, null, 2));
                
                if (membershipId) {
                    // Update existing membership type
                    await apiService.updateMembershipType(parseInt(membershipId), membershipData);
                    uiHelper.showAlert('Membership type updated successfully', 'success');
                } else {
                    // Create new membership type
                    await apiService.createMembershipType(membershipData);
                    uiHelper.showAlert('Membership type created successfully', 'success');
                }
                
                // Hide modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('membershipModal'));
                if (modal) modal.hide();
                
                // Reload membership types
                loadMemberships();
            } catch (error) {
                console.error('Error saving membership type:', error);
                
                // Try to extract more detailed error information
                let errorMessage = 'Error saving membership type';
                if (error.message) {
                    errorMessage += ': ' + error.message;
                }
                
                // If the error contains validation errors, show them
                if (error.errors) {
                    // Handle validation errors
                    const validationErrors = Object.values(error.errors).flat();
                    errorMessage += ': ' + validationErrors.join(', ');
                }
                
                uiHelper.showAlert(errorMessage, 'danger');
            }
        }
        
        // Load products
        async function loadProducts() {
            try {
                const products = await apiService.getProducts();
                
                const tableBody = document.querySelector('#products-table tbody');
                if (!tableBody) return;
                
                tableBody.innerHTML = '';
                
                if (products.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="7" class="text-center">No products found</td></tr>';
                    return;
                }
                
                products.forEach(product => {
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${product.id}</td>
                        <td>${product.name}</td>
                        <td>${product.description}</td>
                        <td>${product.category}</td>
                        <td>${uiHelper.formatCurrency(product.price)}</td>
                        <td>
                            <span class="badge ${product.stockQuantity <= 5 ? 'bg-danger' : 'bg-success'}">
                                ${product.stockQuantity}
                            </span>
                        </td>
                        <td>
                            <div class="btn-group">
                                <button class="btn btn-sm btn-outline-primary view-product-btn" data-id="${product.id}">
                                    <i class="bi bi-eye"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-secondary edit-product-btn" data-id="${product.id}">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger delete-product-btn" data-id="${product.id}">
                                    <i class="bi bi-trash"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-info update-product-stock-btn" data-id="${product.id}" data-stock="${product.stockQuantity}">
                                    <i class="bi bi-box-seam"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                });
                
                // Add event listeners
                document.querySelectorAll('.view-product-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const productId = this.getAttribute('data-id');
                        viewProductDetails(productId);
                    });
                });
                
                document.querySelectorAll('.edit-product-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const productId = this.getAttribute('data-id');
                        openProductModal(productId);
                    });
                });
                
                document.querySelectorAll('.delete-product-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const productId = this.getAttribute('data-id');
                        deleteProduct(productId);
                    });
                });
                
                document.querySelectorAll('.update-product-stock-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const productId = this.getAttribute('data-id');
                        const currentStock = this.getAttribute('data-stock');
                        updateProductStockInline(productId, currentStock);
                    });
                });
            } catch (error) {
                console.error('Error loading products:', error);
                const tableBody = document.querySelector('#products-table tbody');
                if (tableBody) {
                    tableBody.innerHTML = '<tr><td colspan="7" class="text-center text-danger">Error loading products</td></tr>';
                }
            }
        }
        
        async function viewProductDetails(productId) {
            try {
                const product = await apiService.getProductById(productId);
                
                // Create a modal to show product details
                const modalHtml = `
                    <div class="modal fade" id="productDetailsModal" tabindex="-1" aria-labelledby="productDetailsModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="productDetailsModalLabel">Product Details</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <div class="mb-3">
                                        <strong>ID:</strong> ${product.id}
                                    </div>
                                    <div class="mb-3">
                                        <strong>Name:</strong> ${product.name}
                                    </div>
                                    <div class="mb-3">
                                        <strong>Description:</strong> ${product.description}
                                    </div>
                                    <div class="mb-3">
                                        <strong>Category:</strong> ${product.category}
                                    </div>
                                    <div class="mb-3">
                                        <strong>Price:</strong> ${uiHelper.formatCurrency(product.price)}
                                    </div>
                                    <div class="mb-3">
                                        <strong>Stock Quantity:</strong> ${product.stockQuantity}
                                    </div>
                                    ${product.imageUrl ? `
                                        <div class="mb-3">
                                            <strong>Image:</strong><br>
                                            <img src="${getImageUrl(product.imageUrl)}" alt="${product.name}" class="img-thumbnail" style="max-width: 200px;">
                                        </div>
                                    ` : ''}
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Add modal to DOM
                const modalContainer = document.createElement('div');
                modalContainer.innerHTML = modalHtml;
                document.body.appendChild(modalContainer);
                
                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('productDetailsModal'));
                modal.show();
                
                // Remove modal from DOM when hidden
                document.getElementById('productDetailsModal').addEventListener('hidden.bs.modal', function() {
                    document.body.removeChild(modalContainer);
                });
            } catch (error) {
                console.error('Error loading product details:', error);
                uiHelper.showAlert('Error loading product details', 'danger');
            }
        }
        
        // Delete product
        function deleteProduct(productId) {
            uiHelper.confirm('Are you sure you want to delete this product? This action cannot be undone.', async function() {
                try {
                    await apiService.deleteProduct(productId);
                    uiHelper.showAlert('Product deleted successfully', 'success');
                    loadProducts();
                } catch (error) {
                    console.error('Error deleting product:', error);
                    uiHelper.showAlert('Error deleting product', 'danger');
                }
            });
        }
        
        // Update product stock inline
        function updateProductStockInline(productId, currentStock) {
            const newStock = prompt(`Enter new stock quantity (current: ${currentStock}):`);
            if (newStock !== null && !isNaN(newStock) && newStock >= 0) {
                updateProductStock(productId, parseInt(newStock));
            }
        }
        
        async function openProductModal(productId = null) {
            try {
                // Reset form
                const productForm = document.getElementById('product-form');
                if (productForm) productForm.reset();
                
                const productIdInput = document.getElementById('product-id');
                if (productIdInput) productIdInput.value = '';
                
                // Clear image preview but keep track of existing image
                const imagePreview = document.getElementById('product-image-preview');
                if (imagePreview) imagePreview.innerHTML = '';
                
                // Store existing image URL for update scenario
                let existingImageUrl = '';
                
                const modalLabel = document.getElementById('productModalLabel');
                if (!modalLabel) return;
                
                if (productId) {
                    // Edit mode
                    modalLabel.textContent = 'Edit Product';
                    
                    try {
                        // Load product data
                        const product = await apiService.getProductById(productId);
                        
                        if (productIdInput) productIdInput.value = product.id;
                        document.getElementById('product-name').value = product.name;
                        document.getElementById('product-description').value = product.description;
                        document.getElementById('product-category').value = product.category;
                        document.getElementById('product-price').value = product.price;
                        document.getElementById('product-stock').value = product.stockQuantity;
                        
                        // Store existing image URL
                        existingImageUrl = product.imageUrl || '';
                        
                        // Show existing image if available
                        if (product.imageUrl) {
                            imagePreview.innerHTML = `
                                <div class="d-flex align-items-center">
                                    <img src="${getImageUrl(product.imageUrl)}" alt="${product.name}" class="img-thumbnail me-2" style="max-width: 100px;">
                                    <small class="text-muted">Current image - leave blank to keep</small>
                                </div>
                                <input type="hidden" id="existing-image-url" value="${product.imageUrl}">
                            `;
                        }
                    } catch (error) {
                        uiHelper.showAlert('Product not found', 'danger');
                        return;
                    }
                } else {
                    // Create mode
                    modalLabel.textContent = 'Create New Product';
                }
                
                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('productModal'));
                modal.show();
            } catch (error) {
                console.error('Error opening product modal:', error);
                uiHelper.showAlert('Error opening product modal: ' + error.message, 'danger');
            }
        }
        
        async function saveProduct() {
            try {
                const productIdInput = document.getElementById('product-id');
                const productId = productIdInput ? productIdInput.value : null;
                
                const productData = {
                    name: document.getElementById('product-name').value,
                    description: document.getElementById('product-description').value,
                    category: document.getElementById('product-category').value,
                    price: parseFloat(document.getElementById('product-price').value),
                    stockQuantity: parseInt(document.getElementById('product-stock').value)
                };
                
                // Get image file
                const imageFileInput = document.getElementById('product-image-file');
                const imageFile = imageFileInput && imageFileInput.files.length > 0 ? imageFileInput.files[0] : null;
                
                // Get existing image URL for updates
                const existingImageUrlInput = document.getElementById('existing-image-url');
                const existingImageUrl = existingImageUrlInput ? existingImageUrlInput.value : null;
                
                // Validate form
                const productForm = document.getElementById('product-form');
                if (!formValidator.validateForm(productForm, {
                    'product-name': { required: true },
                    'product-description': { required: true },
                    'product-category': { required: true },
                    'product-price': { required: true, min: 0 },
                    'product-stock': { required: true, min: 0 }
                })) {
                    return;
                }
                
                if (productId) {
                    // Update existing product - use ProductUpdateDto
                    await apiService.updateProduct(parseInt(productId), productData, imageFile, existingImageUrl);
                    uiHelper.showAlert('Product updated successfully', 'success');
                } else {
                    // Create new product - use ProductCreateDto
                    await apiService.createProduct(productData, imageFile);
                    uiHelper.showAlert('Product created successfully', 'success');
                }
                
                // Hide modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('productModal'));
                if (modal) modal.hide();
                
                // Reload products
                loadProducts();
            } catch (error) {
                console.error('Error saving product:', error);
                uiHelper.showAlert('Error saving product: ' + error.message, 'danger');
            }
        }
        
        // Load promotions
        async function loadPromotions() {
            try {
                const promotions = await apiService.getPromotions();
                
                const tableBody = document.querySelector('#promotions-table tbody');
                if (!tableBody) return;
                
                tableBody.innerHTML = '';
                
                if (promotions.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="8" class="text-center">No promotions found</td></tr>';
                    return;
                }
                
                promotions.forEach(promotion => {
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${promotion.id}</td>
                        <td>${promotion.code}</td>
                        <td>${promotion.description}</td>
                        <td>${promotion.discountType === 'Percentage' ? `${promotion.discountValue}%` : `$${promotion.discountValue}`}</td>
                        <td>${uiHelper.formatDate(promotion.startDate)}</td>
                        <td>${uiHelper.formatDate(promotion.endDate)}</td>
                        <td>${promotion.timesUsed} / ${promotion.usageLimit}</td>
                        <td>
                            <div class="btn-group">
                                <button class="btn btn-sm btn-outline-primary view-promotion-btn" data-id="${promotion.id}">
                                    <i class="bi bi-eye"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-secondary edit-promotion-btn" data-id="${promotion.id}">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger delete-promotion-btn" data-id="${promotion.id}">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                });
                
                // Add event listeners
                document.querySelectorAll('.view-promotion-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const promotionId = this.getAttribute('data-id');
                        viewPromotionDetails(promotionId);
                    });
                });
                
                document.querySelectorAll('.edit-promotion-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const promotionId = this.getAttribute('data-id');
                        openPromotionModal(promotionId);
                    });
                });
                
                document.querySelectorAll('.delete-promotion-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const promotionId = this.getAttribute('data-id');
                        deletePromotion(promotionId);
                    });
                });
            } catch (error) {
                console.error('Error loading promotions:', error);
                const tableBody = document.querySelector('#promotions-table tbody');
                if (tableBody) {
                    tableBody.innerHTML = '<tr><td colspan="8" class="text-center text-danger">Error loading promotions</td></tr>';
                }
            }
        }
        
        // View promotion details
        async function viewPromotionDetails(promotionId) {
            try {
                const promotion = await apiService.getPromotionById(promotionId);
                
                // Create a modal to show promotion details
                const modalHtml = `
                    <div class="modal fade" id="promotionDetailsModal" tabindex="-1" aria-labelledby="promotionDetailsModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="promotionDetailsModalLabel">Promotion Details</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <div class="mb-3">
                                        <strong>ID:</strong> ${promotion.id}
                                    </div>
                                    <div class="mb-3">
                                        <strong>Code:</strong> ${promotion.code}
                                    </div>
                                    <div class="mb-3">
                                        <strong>Description:</strong> ${promotion.description}
                                    </div>
                                    <div class="mb-3">
                                        <strong>Discount Type:</strong> ${promotion.discountType}
                                    </div>
                                    <div class="mb-3">
                                        <strong>Discount Value:</strong> ${promotion.discountType === 'Percentage' ? `${promotion.discountValue}%` : `$${promotion.discountValue}`}
                                    </div>
                                    <div class="mb-3">
                                        <strong>Start Date:</strong> ${uiHelper.formatDate(promotion.startDate)}
                                    </div>
                                    <div class="mb-3">
                                        <strong>End Date:</strong> ${uiHelper.formatDate(promotion.endDate)}
                                    </div>
                                    <div class="mb-3">
                                        <strong>Usage Limit:</strong> ${promotion.usageLimit}
                                    </div>
                                    <div class="mb-3">
                                        <strong>Times Used:</strong> ${promotion.timesUsed}
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Add modal to DOM
                const modalContainer = document.createElement('div');
                modalContainer.innerHTML = modalHtml;
                document.body.appendChild(modalContainer);
                
                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('promotionDetailsModal'));
                modal.show();
                
                // Remove modal from DOM when hidden
                document.getElementById('promotionDetailsModal').addEventListener('hidden.bs.modal', function() {
                    document.body.removeChild(modalContainer);
                });
            } catch (error) {
                console.error('Error loading promotion details:', error);
                uiHelper.showAlert('Error loading promotion details', 'danger');
            }
        }
        
        // Delete promotion
        function deletePromotion(promotionId) {
            uiHelper.confirm('Are you sure you want to delete this promotion? This action cannot be undone.', async function() {
                try {
                    await apiService.deletePromotion(promotionId);
                    uiHelper.showAlert('Promotion deleted successfully', 'success');
                    loadPromotions();
                } catch (error) {
                    console.error('Error deleting promotion:', error);
                    uiHelper.showAlert('Error deleting promotion', 'danger');
                }
            });
        }
        
        // Open promotion modal (create or edit)
        async function openPromotionModal(promotionId = null) {
            try {
                // Reset form
                const promotionForm = document.getElementById('promotion-form');
                if (promotionForm) promotionForm.reset();
                
                const promotionIdInput = document.getElementById('promotion-id');
                if (promotionIdInput) promotionIdInput.value = '';
                
                const modalLabel = document.getElementById('promotionModalLabel');
                if (!modalLabel) return;
                
                if (promotionId) {
                    // Edit mode
                    modalLabel.textContent = 'Edit Promotion';
                    
                    // Load promotion data
                    const promotion = await apiService.getPromotionById(promotionId);
                    
                    if (promotionIdInput) promotionIdInput.value = promotion.id;
                    document.getElementById('promotion-code').value = promotion.code;
                    document.getElementById('promotion-description').value = promotion.description;
                    document.getElementById('promotion-type').value = promotion.discountType;
                    document.getElementById('promotion-value').value = promotion.discountValue;
                    document.getElementById('promotion-start').value = utils.formatDateForInput(new Date(promotion.startDate));
                    document.getElementById('promotion-end').value = utils.formatDateForInput(new Date(promotion.endDate));
                    document.getElementById('promotion-limit').value = promotion.usageLimit;
                } else {
                    // Create mode
                    modalLabel.textContent = 'Create New Promotion';
                    
                    // Set default dates
                    const today = new Date();
                    const nextMonth = new Date();
                    nextMonth.setMonth(today.getMonth() + 1);
                    
                    document.getElementById('promotion-start').value = utils.formatDateForInput(today);
                    document.getElementById('promotion-end').value = utils.formatDateForInput(nextMonth);
                }
                
                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('promotionModal'));
                modal.show();
            } catch (error) {
                console.error('Error opening promotion modal:', error);
                uiHelper.showAlert('Error opening promotion modal', 'danger');
            }
        }
        
        // Save promotion
        async function savePromotion() {
            try {
                const promotionIdInput = document.getElementById('promotion-id');
                const promotionId = promotionIdInput ? promotionIdInput.value : null;
                
                const promotionData = {
                    code: document.getElementById('promotion-code').value,
                    description: document.getElementById('promotion-description').value,
                    discountType: document.getElementById('promotion-type').value,
                    discountValue: parseFloat(document.getElementById('promotion-value').value),
                    startDate: new Date(document.getElementById('promotion-start').value),
                    endDate: new Date(document.getElementById('promotion-end').value),
                    usageLimit: parseInt(document.getElementById('promotion-limit').value)
                };
                
                // Validate form
                const promotionForm = document.getElementById('promotion-form');
                if (!formValidator.validateForm(promotionForm, {
                    'promotion-code': { required: true },
                    'promotion-description': { required: true },
                    'promotion-type': { required: true },
                    'promotion-value': { required: true, min: 0 },
                    'promotion-start': { required: true },
                    'promotion-end': { required: true },
                    'promotion-limit': { required: true, min: 1 }
                })) {
                    return;
                }
                
                // Validate date range
                if (promotionData.startDate >= promotionData.endDate) {
                    uiHelper.showAlert('End date must be after start date', 'danger');
                    return;
                }
                
                if (promotionId) {
                    // Update existing promotion
                    await apiService.updatePromotion(parseInt(promotionId), promotionData);
                    uiHelper.showAlert('Promotion updated successfully', 'success');
                } else {
                    // Create new promotion
                    await apiService.createPromotion(promotionData);
                    uiHelper.showAlert('Promotion created successfully', 'success');
                }
                
                // Hide modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('promotionModal'));
                if (modal) modal.hide();
                
                // Reload promotions
                loadPromotions();
            } catch (error) {
                console.error('Error saving promotion:', error);
                uiHelper.showAlert('Error saving promotion', 'danger');
            }
        }
        
        // Load orders
        async function loadOrders() {
            try {
                const ordersStatusFilter = document.getElementById('orders-status-filter');
                const status = ordersStatusFilter ? ordersStatusFilter.value : null;
                
                let orders = await apiService.getAllOrders();
                
                // Filter by status if selected
                if (status) {
                    orders = orders.filter(order => order.status === status);
                }
                
                const tableBody = document.querySelector('#orders-table tbody');
                if (!tableBody) return;
                
                tableBody.innerHTML = '';
                
                if (orders.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="6" class="text-center">No orders found</td></tr>';
                    return;
                }
                
                orders.forEach(order => {
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${order.id}</td>
                        <td>${order.userName}</td>
                        <td>${uiHelper.formatDate(order.orderDate)}</td>
                        <td>${uiHelper.formatCurrency(order.totalAmount)}</td>
                        <td>
                            <span class="badge ${
                                order.status === 'Completed' ? 'bg-success' : 
                                order.status === 'Pending' ? 'bg-warning' : 'bg-danger'
                            }">
                                ${order.status}
                            </span>
                        </td>
                        <td>
                            <div class="btn-group">
                                <button class="btn btn-sm btn-outline-primary view-order-btn" data-id="${order.id}">
                                    <i class="bi bi-eye"></i>
                                </button>
                                ${order.status !== 'Completed' && order.status !== 'Cancelled' ? `
                                    <button class="btn btn-sm btn-outline-secondary update-order-status-btn" data-id="${order.id}">
                                        <i class="bi bi-arrow-repeat"></i>
                                    </button>
                                ` : ''}
                                ${order.status !== 'Cancelled' ? `
                                    <button class="btn btn-sm btn-outline-danger cancel-order-btn" data-id="${order.id}">
                                        <i class="bi bi-x-circle"></i>
                                    </button>
                                ` : ''}
                            </div>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                });
                
                // Add event listeners
                document.querySelectorAll('.view-order-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const orderId = this.getAttribute('data-id');
                        viewOrderDetails(orderId);
                    });
                });
                
                document.querySelectorAll('.update-order-status-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const orderId = this.getAttribute('data-id');
                        updateOrderStatus(orderId);
                    });
                });
                
                document.querySelectorAll('.cancel-order-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const orderId = this.getAttribute('data-id');
                        cancelOrder(orderId);
                    });
                });
            } catch (error) {
                console.error('Error loading orders:', error);
                const tableBody = document.querySelector('#orders-table tbody');
                if (tableBody) {
                    tableBody.innerHTML = '<tr><td colspan="6" class="text-center text-danger">Error loading orders</td></tr>';
                }
            }
        }
        
        // View order details
        async function viewOrderDetails(orderId) {
            try {
                const order = await apiService.getOrderById(orderId);
                
                // Create a modal to show order details
                let itemsHtml = '';
                order.orderItems.forEach(item => {
                    itemsHtml += `
                        <tr>
                            <td>${item.productName}</td>
                            <td>${item.quantity}</td>
                            <td>${uiHelper.formatCurrency(item.price)}</td>
                            <td>${uiHelper.formatCurrency(item.totalPrice)}</td>
                        </tr>
                    `;
                });
                
                const modalHtml = `
                    <div class="modal fade" id="orderDetailsModal" tabindex="-1" aria-labelledby="orderDetailsModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="orderDetailsModalLabel">Order Details</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <strong>Order ID:</strong> ${order.id}
                                        </div>
                                        <div class="col-md-6">
                                            <strong>Order Date:</strong> ${uiHelper.formatDate(order.orderDate)}
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <strong>Customer:</strong> ${order.userName}
                                        </div>
                                        <div class="col-md-6">
                                            <strong>Status:</strong> 
                                            <span class="badge ${
                                                order.status === 'Completed' ? 'bg-success' : 
                                                order.status === 'Pending' ? 'bg-warning' : 'bg-danger'
                                            }">
                                                ${order.status}
                                            </span>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-12">
                                            <strong>Total Amount:</strong> ${uiHelper.formatCurrency(order.totalAmount)}
                                        </div>
                                    </div>
                                    <h6 class="mt-4 mb-3">Order Items</h6>
                                    <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Product</th>
                                                    <th>Quantity</th>
                                                    <th>Price</th>
                                                    <th>Total</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                ${itemsHtml}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Add modal to DOM
                const modalContainer = document.createElement('div');
                modalContainer.innerHTML = modalHtml;
                document.body.appendChild(modalContainer);
                
                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('orderDetailsModal'));
                modal.show();
                
                // Remove modal from DOM when hidden
                document.getElementById('orderDetailsModal').addEventListener('hidden.bs.modal', function() {
                    document.body.removeChild(modalContainer);
                });
            } catch (error) {
                console.error('Error loading order details:', error);
                uiHelper.showAlert('Error loading order details', 'danger');
            }
        }
        
        // Update order status
        function updateOrderStatus(orderId) {
            const statuses = ['Pending', 'Completed', 'Cancelled'];
            const currentStatus = ''; // This would need to be fetched from the order
            
            // Create a simple select dropdown for status update
            const statusOptions = statuses.map(status => 
                `<option value="${status}" ${status === currentStatus ? 'selected' : ''}>${status}</option>`
            ).join('');
            
            const modalHtml = `
                <div class="modal fade" id="updateOrderStatusModal" tabindex="-1" aria-labelledby="updateOrderStatusModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="updateOrderStatusModalLabel">Update Order Status</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="mb-3">
                                    <label for="order-status" class="form-label">Status</label>
                                    <select class="form-select" id="order-status">
                                        ${statusOptions}
                                    </select>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary" id="save-order-status-btn" data-id="${orderId}">Update</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Add modal to DOM
            const modalContainer = document.createElement('div');
            modalContainer.innerHTML = modalHtml;
            document.body.appendChild(modalContainer);
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('updateOrderStatusModal'));
            modal.show();
            
            // Add event listener to save button
            document.getElementById('save-order-status-btn').addEventListener('click', function() {
                const newStatus = document.getElementById('order-status').value;
                saveOrderStatus(orderId, newStatus);
            });
            
            // Remove modal from DOM when hidden
            document.getElementById('updateOrderStatusModal').addEventListener('hidden.bs.modal', function() {
                document.body.removeChild(modalContainer);
            });
        }
        
        // Save order status
        async function saveOrderStatus(orderId, status) {
            try {
                await apiService.updateOrderStatus(orderId, status);
                uiHelper.showAlert('Order status updated successfully', 'success');
                
                // Hide modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('updateOrderStatusModal'));
                if (modal) modal.hide();
                
                // Reload orders
                loadOrders();
            } catch (error) {
                console.error('Error updating order status:', error);
                uiHelper.showAlert('Error updating order status', 'danger');
            }
        }
        
        // Cancel order
        function cancelOrder(orderId) {
            uiHelper.confirm('Are you sure you want to cancel this order?', async function() {
                try {
                    await apiService.cancelOrder(orderId);
                    uiHelper.showAlert('Order cancelled successfully', 'success');
                    loadOrders();
                } catch (error) {
                    console.error('Error cancelling order:', error);
                    uiHelper.showAlert('Error cancelling order', 'danger');
                }
            });
        }
        
        // Generate revenue report
        async function generateRevenueReport() {
            try {
                const reportStartDate = document.getElementById('report-start-date');
                const reportEndDate = document.getElementById('report-end-date');
                
                const startDate = reportStartDate ? reportStartDate.value : null;
                const endDate = reportEndDate ? reportEndDate.value : null;
                
                if (!startDate || !endDate) {
                    uiHelper.showAlert('Please select both start and end dates', 'warning');
                    return;
                }
                
                if (new Date(startDate) >= new Date(endDate)) {
                    uiHelper.showAlert('End date must be after start date', 'warning');
                    return;
                }
                
                // Format dates as ISO strings (YYYY-MM-DD)
                const formattedStartDate = new Date(startDate).toISOString().split('T')[0];
                const formattedEndDate = new Date(endDate).toISOString().split('T')[0];
                
                const revenueData = await apiService.getRevenueReport(formattedStartDate, formattedEndDate);
                
                // Update report table
                const tableBody = document.querySelector('#report-table tbody');
                if (!tableBody) return;
                
                tableBody.innerHTML = '';
                
                if (revenueData.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="5" class="text-center">No data found for the selected period</td></tr>';
                    return;
                }
                
                revenueData.forEach(item => {
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${uiHelper.formatDate(new Date(item.date))}</td>
                        <td>${uiHelper.formatCurrency(item.membershipRevenue)}</td>
                        <td>${uiHelper.formatCurrency(item.productRevenue)}</td>
                        <td>${uiHelper.formatCurrency(item.totalRevenue)}</td>
                        <td>${item.bookingsCount}</td>
                    `;
                    
                    tableBody.appendChild(row);
                });
                
                // Update report chart
                updateReportChart(revenueData);
            } catch (error) {
                console.error('Error generating revenue report:', error);
                uiHelper.showAlert('Error generating revenue report: ' + error.message, 'danger');
            }
        }
        
        // Update report chart
        let reportChart = null;
        function updateReportChart(revenueData) {
            const ctx = document.getElementById('reportChart');
            if (!ctx) return;
            
            const chartCtx = ctx.getContext('2d');
            
            // Destroy existing chart if it exists
            if (reportChart) {
                reportChart.destroy();
            }
            
            // Prepare data for chart
            const labels = revenueData.map(item => uiHelper.formatDate(new Date(item.date)));
            const membershipRevenue = revenueData.map(item => item.membershipRevenue);
            const productRevenue = revenueData.map(item => item.productRevenue);
            
            // Create new chart
            reportChart = new Chart(chartCtx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Membership Revenue',
                            data: membershipRevenue,
                            backgroundColor: 'rgba(128, 0, 32, 0.8)',
                            borderColor: 'rgba(128, 0, 32, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Product Revenue',
                            data: productRevenue,
                            backgroundColor: 'rgba(107, 142, 35, 0.8)',
                            borderColor: 'rgba(107, 142, 35, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: true,
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            stacked: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            },
                            grid: {
                                color: 'rgb(234, 236, 244)'
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(tooltipItem, chart) {
                                    let label = chart.datasets[tooltipItem.datasetIndex].label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    label += '$' + tooltipItem.yLabel.toLocaleString();
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Initialize form validation
        function initializeFormValidation() {
            // Add event listeners for form validation
            const forms = document.querySelectorAll('.modal-body form');
            forms.forEach(form => {
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                    // Form validation is handled in the save functions
                });
            });
        }
    </script>
</body>
</html>